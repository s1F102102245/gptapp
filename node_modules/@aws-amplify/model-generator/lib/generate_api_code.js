import { fromNodeProviderChain } from '@aws-sdk/credential-providers';
import { createGraphqlModelsGenerator } from './create_graphql_models_generator.js';
import { createGraphqlTypesGenerator } from './create_graphql_types_generator.js';
import { createGraphqlDocumentGenerator } from './create_graphql_document_generator.js';
import { getOutputFileName } from '@aws-amplify/graphql-types-generator';
import path from 'path';
export var GenerateApiCodeFormat;
(function (GenerateApiCodeFormat) {
    GenerateApiCodeFormat["MODELGEN"] = "modelgen";
    GenerateApiCodeFormat["GRAPHQL_CODEGEN"] = "graphql-codegen";
    GenerateApiCodeFormat["INTROSPECTION"] = "introspection";
})(GenerateApiCodeFormat || (GenerateApiCodeFormat = {}));
export var GenerateApiCodeModelTarget;
(function (GenerateApiCodeModelTarget) {
    GenerateApiCodeModelTarget["JAVA"] = "java";
    GenerateApiCodeModelTarget["SWIFT"] = "swift";
    GenerateApiCodeModelTarget["JAVASCRIPT"] = "javascript";
    GenerateApiCodeModelTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeModelTarget["DART"] = "dart";
})(GenerateApiCodeModelTarget || (GenerateApiCodeModelTarget = {}));
export var GenerateApiCodeStatementTarget;
(function (GenerateApiCodeStatementTarget) {
    GenerateApiCodeStatementTarget["JAVASCRIPT"] = "javascript";
    GenerateApiCodeStatementTarget["GRAPHQL"] = "graphql";
    GenerateApiCodeStatementTarget["FLOW"] = "flow";
    GenerateApiCodeStatementTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeStatementTarget["ANGULAR"] = "angular";
})(GenerateApiCodeStatementTarget || (GenerateApiCodeStatementTarget = {}));
export var GenerateApiCodeTypeTarget;
(function (GenerateApiCodeTypeTarget) {
    GenerateApiCodeTypeTarget["JSON"] = "json";
    GenerateApiCodeTypeTarget["SWIFT"] = "swift";
    GenerateApiCodeTypeTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeTypeTarget["FLOW"] = "flow";
    GenerateApiCodeTypeTarget["SCALA"] = "scala";
    GenerateApiCodeTypeTarget["FLOW_MODERN"] = "flow-modern";
    GenerateApiCodeTypeTarget["ANGULAR"] = "angular";
})(GenerateApiCodeTypeTarget || (GenerateApiCodeTypeTarget = {}));
/**
 * Generate api code using Api Code Generator with default generators.
 */
export const generateApiCode = async (props) => {
    const { credentialProvider = fromNodeProviderChain() } = props;
    const backendIdentifier = props;
    return new ApiCodeGenerator(createGraphqlDocumentGenerator({ backendIdentifier, credentialProvider }), createGraphqlTypesGenerator({ backendIdentifier, credentialProvider }), createGraphqlModelsGenerator({ backendIdentifier, credentialProvider })).generate(props);
};
/**
 * Generator for Api Code resources.
 */
export class ApiCodeGenerator {
    graphqlDocumentGenerator;
    graphqlTypesGenerator;
    graphqlModelsGenerator;
    /**
     * Construct generator, passing in nested generators.
     * @param graphqlDocumentGenerator the graphql document generator
     * @param graphqlTypesGenerator the type generator
     * @param graphqlModelsGenerator the model object generator
     */
    constructor(graphqlDocumentGenerator, graphqlTypesGenerator, graphqlModelsGenerator) {
        this.graphqlDocumentGenerator = graphqlDocumentGenerator;
        this.graphqlTypesGenerator = graphqlTypesGenerator;
        this.graphqlModelsGenerator = graphqlModelsGenerator;
    }
    /**
     * Execute the generation.
     * @param props the required generate options.
     * @returns a promise with the generation results
     */
    generate(props) {
        switch (props.format) {
            case 'graphql-codegen': {
                return this.generateGraphqlCodegenApiCode(props);
            }
            case 'modelgen': {
                return this.generateModelgenApiCode(props);
            }
            case 'introspection': {
                return this.generateIntrospectionApiCode();
            }
            default:
                throw new Error(`${props.format} is not a supported format.`);
        }
    }
    /**
     * Execute document, and optionally type generation with relevant targets, wiring through types into statements if possible.
     */
    async generateGraphqlCodegenApiCode(props) {
        const generateModelsParams = {
            language: props.statementTarget,
            maxDepth: props.maxDepth,
            typenameIntrospection: props.typeNameIntrospection,
        };
        if (props.statementTarget === GenerateApiCodeStatementTarget.TYPESCRIPT &&
            props.typeTarget === GenerateApiCodeTypeTarget.TYPESCRIPT) {
            // Cast to unknown to string since the original input to this is typed as a required string, but expects an optional
            // value, and we want to rely on that behavior.
            const typeOutputFilepath = getOutputFileName(null, props.typeTarget);
            const fileName = path.parse(typeOutputFilepath).name;
            // This is an node import path, so we don't want to use path.join, since that'll produce invalid paths on windows platforms
            // Hard-coding since this method explicitly writes to the same directory if types are enabled.
            generateModelsParams.relativeTypesPath = `./${fileName}`;
        }
        const documents = await this.graphqlDocumentGenerator.generateModels(generateModelsParams);
        if (props.typeTarget) {
            const types = await this.graphqlTypesGenerator.generateTypes({
                target: props.typeTarget,
                multipleSwiftFiles: props.multipleSwiftFiles,
            });
            return {
                writeToDirectory: async (directoryPath) => {
                    await Promise.all([
                        documents.writeToDirectory(directoryPath),
                        types.writeToDirectory(directoryPath),
                    ]);
                },
                getResults: async () => ({
                    ...(await documents.getResults()),
                    ...(await types.getResults()),
                }),
            };
        }
        return documents;
    }
    /**
     * Execute model generation with model target.
     */
    async generateModelgenApiCode(props) {
        return this.graphqlModelsGenerator.generateModels({
            target: props.modelTarget,
            generateIndexRules: props.generateIndexRules,
            emitAuthProvider: props.emitAuthProvider,
            useExperimentalPipelinedTransformer: props.useExperimentalPipelinedTransformer,
            transformerVersion: props.transformerVersion,
            respectPrimaryKeyAttributesOnConnectionField: props.respectPrimaryKeyAttributesOnConnectionField,
            generateModelsForLazyLoadAndCustomSelectionSet: props.generateModelsForLazyLoadAndCustomSelectionSet,
            addTimestampFields: props.addTimestampFields,
            handleListNullabilityTransparently: props.handleListNullabilityTransparently,
        });
    }
    /**
     * Execute model generation with introspection target.
     */
    async generateIntrospectionApiCode() {
        return this.graphqlModelsGenerator.generateModels({
            target: 'introspection',
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVfYXBpX2NvZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZ2VuZXJhdGVfYXBpX2NvZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFTdEUsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDcEYsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDbEYsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDeEYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDekUsT0FBTyxJQUFJLE1BQU0sTUFBTSxDQUFDO0FBR3hCLE1BQU0sQ0FBTixJQUFZLHFCQUlYO0FBSkQsV0FBWSxxQkFBcUI7SUFDL0IsOENBQXFCLENBQUE7SUFDckIsNERBQW1DLENBQUE7SUFDbkMsd0RBQStCLENBQUE7QUFDakMsQ0FBQyxFQUpXLHFCQUFxQixLQUFyQixxQkFBcUIsUUFJaEM7QUFFRCxNQUFNLENBQU4sSUFBWSwwQkFNWDtBQU5ELFdBQVksMEJBQTBCO0lBQ3BDLDJDQUFhLENBQUE7SUFDYiw2Q0FBZSxDQUFBO0lBQ2YsdURBQXlCLENBQUE7SUFDekIsdURBQXlCLENBQUE7SUFDekIsMkNBQWEsQ0FBQTtBQUNmLENBQUMsRUFOVywwQkFBMEIsS0FBMUIsMEJBQTBCLFFBTXJDO0FBRUQsTUFBTSxDQUFOLElBQVksOEJBTVg7QUFORCxXQUFZLDhCQUE4QjtJQUN4QywyREFBeUIsQ0FBQTtJQUN6QixxREFBbUIsQ0FBQTtJQUNuQiwrQ0FBYSxDQUFBO0lBQ2IsMkRBQXlCLENBQUE7SUFDekIscURBQW1CLENBQUE7QUFDckIsQ0FBQyxFQU5XLDhCQUE4QixLQUE5Qiw4QkFBOEIsUUFNekM7QUFFRCxNQUFNLENBQU4sSUFBWSx5QkFRWDtBQVJELFdBQVkseUJB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QUFDLGtDQUFrQztTQUMzQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsNEJBQTRCO1FBQ3hDLE9BQU8sSUFBSSxDQUFDLHNCQUFzQixDQUFDLGNBQWMsQ0FBQztZQUNoRCxNQUFNLEVBQUUsZUFBZTtTQUN4QixDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmcm9tTm9kZVByb3ZpZGVyQ2hhaW4gfSBmcm9tICdAYXdzLXNkay9jcmVkZW50aWFsLXByb3ZpZGVycyc7XG5pbXBvcnQgeyBBd3NDcmVkZW50aWFsSWRlbnRpdHlQcm92aWRlciB9IGZyb20gJ0Bhd3Mtc2RrL3R5cGVzJztcbmltcG9ydCB7XG4gIERvY3VtZW50R2VuZXJhdGlvblBhcmFtZXRlcnMsXG4gIEdlbmVyYXRpb25SZXN1bHQsXG4gIEdyYXBocWxEb2N1bWVudEdlbmVyYXRvcixcbiAgR3JhcGhxbE1vZGVsc0dlbmVyYXRvcixcbiAgR3JhcGhxbFR5cGVzR2VuZXJhdG9yLFxufSBmcm9tICcuL21vZGVsX2dlbmVyYXRvci5qcyc7XG5pbXBvcnQgeyBjcmVhdGVHcmFwaHFsTW9kZWxzR2VuZXJhdG9yIH0gZnJvbSAnLi9jcmVhdGVfZ3JhcGhxbF9tb2RlbHNfZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7IGNyZWF0ZUdyYXBocWxUeXBlc0dlbmVyYXRvciB9IGZyb20gJy4vY3JlYXRlX2dyYXBocWxfdHlwZXNfZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7IGNyZWF0ZUdyYXBocWxEb2N1bWVudEdlbmVyYXRvciB9IGZyb20gJy4vY3JlYXRlX2dyYXBocWxfZG9jdW1lbnRfZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7IGdldE91dHB1dEZpbGVOYW1lIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L2dyYXBocWwtdHlwZXMtZ2VuZXJhdG9yJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRGVwbG95ZWRCYWNrZW5kSWRlbnRpZmllciB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9kZXBsb3llZC1iYWNrZW5kLWNsaWVudCc7XG5cbmV4cG9ydCBlbnVtIEdlbmVyYXRlQXBpQ29kZUZvcm1hdCB7XG4gIE1PREVMR0VOID0gJ21vZGVsZ2VuJyxcbiAgR1JBUEhRTF9DT0RFR0VOID0gJ2dyYXBocWwtY29kZWdlbicsXG4gIElOVFJPU1BFQ1RJT04gPSAnaW50cm9zcGVjdGlvbicsXG59XG5cbmV4cG9ydCBlbnVtIEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0IHtcbiAgSkFWQSA9ICdqYXZhJyxcbiAgU1dJRlQgPSAnc3dpZnQnLFxuICBKQVZBU0NSSVBUID0gJ2phdmFzY3JpcHQnLFxuICBUWVBFU0NSSVBUID0gJ3R5cGVzY3JpcHQnLFxuICBEQVJUID0gJ2RhcnQnLFxufVxuXG5leHBvcnQgZW51bSBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQge1xuICBKQVZBU0NSSVBUID0gJ2phdmFzY3JpcHQnLFxuICBHUkFQSFFMID0gJ2dyYXBocWwnLFxuICBGTE9XID0gJ2Zsb3cnLFxuICBUWVBFU0NSSVBUID0gJ3R5cGVzY3JpcHQnLFxuICBBTkdVTEFSID0gJ2FuZ3VsYXInLFxufVxuXG5leHBvcnQgZW51bSBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0IHtcbiAgSlNPTiA9ICdqc29uJyxcbiAgU1dJRlQgPSAnc3dpZnQnLFxuICBUWVBFU0NSSVBUID0gJ3R5cGVzY3JpcHQnLFxuICBGTE9XID0gJ2Zsb3cnLFxuICBTQ0FMQSA9ICdzY2FsYScsXG4gIEZMT1dfTU9ERVJOID0gJ2Zsb3ctbW9kZXJuJyxcbiAgQU5HVUxBUiA9ICdhbmd1bGFyJyxcbn1cblxuZXhwb3J0IHR5cGUgR2VuZXJhdGVNb2RlbHNPcHRpb25zID0ge1xuICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5NT0RFTEdFTjtcbiAgbW9kZWxUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0O1xuICBnZW5lcmF0ZUluZGV4UnVsZXM/OiBib29sZWFuO1xuICBlbWl0QXV0aFByb3ZpZGVyPzogYm9vbGVhbjtcbiAgdXNlRXhwZXJpbWVudGFsUGlwZWxpbmVkVHJhbnNmb3JtZXI/OiBib29sZWFuO1xuICB0cmFuc2Zvcm1lclZlcnNpb24/OiBib29sZWFuO1xuICByZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZD86IGJvb2xlYW47XG4gIGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQ/OiBib29sZWFuO1xuICBhZGRUaW1lc3RhbXBGaWVsZHM/OiBib29sZWFuO1xuICBoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5PzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCB0eXBlIEdlbmVyYXRlR3JhcGhxbENvZGVnZW5PcHRpb25zID0ge1xuICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5HUkFQSFFMX0NPREVHRU47XG4gIHN0YXRlbWVudFRhcmdldDogR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0O1xuICBtYXhEZXB0aD86IG51bWJlcjtcbiAgdHlwZU5hbWVJbnRyb3NwZWN0aW9uPzogYm9vbGVhbjtcbiAgdHlwZVRhcmdldD86IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQ7XG4gIG11bHRpcGxlU3dpZnRGaWxlcz86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBHZW5lcmF0ZUludHJvc3BlY3Rpb25PcHRpb25zID0ge1xuICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5JTlRST1NQRUNUSU9OO1xufTtcblxuZXhwb3J0IHR5cGUgR2VuZXJhdGVPcHRpb25zID1cbiAgfCBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9uc1xuICB8IEdlbmVyYXRlTW9kZWxzT3B0aW9uc1xuICB8IEdlbmVyYXRlSW50cm9zcGVjdGlvbk9wdGlvbnM7XG5cbmV4cG9ydCB0eXBlIEdlbmVyYXRlQXBpQ29kZVByb3BzID0gR2VuZXJhdGVPcHRpb25zICZcbiAgRGVwbG95ZWRCYWNrZW5kSWRlbnRpZmllciAmIHtcbiAgICBjcmVkZW50aWFsUHJvdmlkZXI6IEF3c0NyZWRlbnRpYWxJZGVudGl0eVByb3ZpZGVyO1xuICB9O1xuXG4vKipcbiAqIEdlbmVyYXRlIGFwaSBjb2RlIHVzaW5nIEFwaSBDb2RlIEdlbmVyYXRvciB3aXRoIGRlZmF1bHQgZ2VuZXJhdG9ycy5cbiAqL1xuZXhwb3J0IGNvbnN0IGdlbmVyYXRlQXBpQ29kZSA9IGFzeW5jIChcbiAgcHJvcHM6IEdlbmVyYXRlQXBpQ29kZVByb3BzXG4pOiBQcm9taXNlPEdlbmVyYXRpb25SZXN1bHQ+ID0+IHtcbiAgY29uc3QgeyBjcmVkZW50aWFsUHJvdmlkZXIgPSBmcm9tTm9kZVByb3ZpZGVyQ2hhaW4oKSB9ID0gcHJvcHM7XG4gIGNvbnN0IGJhY2tlbmRJZGVudGlmaWVyID0gcHJvcHM7XG4gIHJldHVybiBuZXcgQXBpQ29kZUdlbmVyYXRvcihcbiAgICBjcmVhdGVHcmFwaHFsRG9jdW1lbnRHZW5lcmF0b3IoeyBiYWNrZW5kSWRlbnRpZmllciwgY3JlZGVudGlhbFByb3ZpZGVyIH0pLFxuICAgIGNyZWF0ZUdyYXBocWxUeXBlc0dlbmVyYXRvcih7IGJhY2tlbmRJZGVudGlmaWVyLCBjcmVkZW50aWFsUHJvdmlkZXIgfSksXG4gICAgY3JlYXRlR3JhcGhxbE1vZGVsc0dlbmVyYXRvcih7IGJhY2tlbmRJZGVudGlmaWVyLCBjcmVkZW50aWFsUHJvdmlkZXIgfSlcbiAgKS5nZW5lcmF0ZShwcm9wcyk7XG59O1xuXG4vKipcbiAqIEdlbmVyYXRvciBmb3IgQXBpIENvZGUgcmVzb3VyY2VzLlxuICovXG5leHBvcnQgY2xhc3MgQXBpQ29kZUdlbmVyYXRvciB7XG4gIC8qKlxuICAgKiBDb25zdHJ1Y3QgZ2VuZXJhdG9yLCBwYXNzaW5nIGluIG5lc3RlZCBnZW5lcmF0b3JzLlxuICAgKiBAcGFyYW0gZ3JhcGhxbERvY3VtZW50R2VuZXJhdG9yIHRoZSBncmFwaHFsIGRvY3VtZW50IGdlbmVyYXRvclxuICAgKiBAcGFyYW0gZ3JhcGhxbFR5cGVzR2VuZXJhdG9yIHRoZSB0eXBlIGdlbmVyYXRvclxuICAgKiBAcGFyYW0gZ3JhcGhxbE1vZGVsc0dlbmVyYXRvciB0aGUgbW9kZWwgb2JqZWN0IGdlbmVyYXRvclxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBncmFwaHFsRG9jdW1lbnRHZW5lcmF0b3I6IEdyYXBocWxEb2N1bWVudEdlbmVyYXRvcixcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdyYXBocWxUeXBlc0dlbmVyYXRvcjogR3JhcGhxbFR5cGVzR2VuZXJhdG9yLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZ3JhcGhxbE1vZGVsc0dlbmVyYXRvcjogR3JhcGhxbE1vZGVsc0dlbmVyYXRvclxuICApIHt9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgdGhlIGdlbmVyYXRpb24uXG4gICAqIEBwYXJhbSBwcm9wcyB0aGUgcmVxdWlyZWQgZ2VuZXJhdGUgb3B0aW9ucy5cbiAgICogQHJldHVybnMgYSBwcm9taXNlIHdpdGggdGhlIGdlbmVyYXRpb24gcmVzdWx0c1xuICAgKi9cbiAgZ2VuZXJhdGUocHJvcHM6IEdlbmVyYXRlT3B0aW9ucyk6IFByb21pc2U8R2VuZXJhdGlvblJlc3VsdD4ge1xuICAgIHN3aXRjaCAocHJvcHMuZm9ybWF0KSB7XG4gICAgICBjYXNlICdncmFwaHFsLWNvZGVnZW4nOiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlR3JhcGhxbENvZGVnZW5BcGlDb2RlKHByb3BzKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgJ21vZGVsZ2VuJzoge1xuICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZU1vZGVsZ2VuQXBpQ29kZShwcm9wcyk7XG4gICAgICB9XG4gICAgICBjYXNlICdpbnRyb3NwZWN0aW9uJzoge1xuICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUludHJvc3BlY3Rpb25BcGlDb2RlKCk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYCR7XG4gICAgICAgICAgICAocHJvcHMgYXMgR2VuZXJhdGVBcGlDb2RlUHJvcHMpLmZvcm1hdCBhcyBzdHJpbmdcbiAgICAgICAgICB9IGlzIG5vdCBhIHN1cHBvcnRlZCBmb3JtYXQuYFxuICAgICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGRvY3VtZW50LCBhbmQgb3B0aW9uYWxseSB0eXBlIGdlbmVyYXRpb24gd2l0aCByZWxldmFudCB0YXJnZXRzLCB3aXJpbmcgdGhyb3VnaCB0eXBlcyBpbnRvIHN0YXRlbWVudHMgaWYgcG9zc2libGUuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlR3JhcGhxbENvZGVnZW5BcGlDb2RlKFxuICAgIHByb3BzOiBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9uc1xuICApOiBQcm9taXNlPEdlbmVyYXRpb25SZXN1bHQ+IHtcbiAgICBjb25zdCBnZW5lcmF0ZU1vZGVsc1BhcmFtczogRG9jdW1lbnRHZW5lcmF0aW9uUGFyYW1ldGVycyA9IHtcbiAgICAgIGxhbmd1YWdlOiBwcm9wcy5zdGF0ZW1lbnRUYXJnZXQsXG4gICAgICBtYXhEZXB0aDogcHJvcHMubWF4RGVwdGgsXG4gICAgICB0eXBlbmFtZUludHJvc3BlY3Rpb246IHByb3BzLnR5cGVOYW1lSW50cm9zcGVjdGlvbixcbiAgICB9O1xuICAgIGlmIChcbiAgICAgIHByb3BzLnN0YXRlbWVudFRhcmdldCA9PT0gR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LlRZUEVTQ1JJUFQgJiZcbiAgICAgIHByb3BzLnR5cGVUYXJnZXQgPT09IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQuVFlQRVNDUklQVFxuICAgICkge1xuICAgICAgLy8gQ2FzdCB0byB1bmtub3duIHRvIHN0cmluZyBzaW5jZSB0aGUgb3JpZ2luYWwgaW5wdXQgdG8gdGhpcyBpcyB0eXBlZCBhcyBhIHJlcXVpcmVkIHN0cmluZywgYnV0IGV4cGVjdHMgYW4gb3B0aW9uYWxcbiAgICAgIC8vIHZhbHVlLCBhbmQgd2Ugd2FudCB0byByZWx5IG9uIHRoYXQgYmVoYXZpb3IuXG4gICAgICBjb25zdCB0eXBlT3V0cHV0RmlsZXBhdGggPSBnZXRPdXRwdXRGaWxlTmFtZShcbiAgICAgICAgbnVsbCBhcyB1bmtub3duIGFzIHN0cmluZyxcbiAgICAgICAgcHJvcHMudHlwZVRhcmdldFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gcGF0aC5wYXJzZSh0eXBlT3V0cHV0RmlsZXBhdGgpLm5hbWU7XG4gICAgICAvLyBUaGlzIGlzIGFuIG5vZGUgaW1wb3J0IHBhdGgsIHNvIHdlIGRvbid0IHdhbnQgdG8gdXNlIHBhdGguam9pbiwgc2luY2UgdGhhdCdsbCBwcm9kdWNlIGludmFsaWQgcGF0aHMgb24gd2luZG93cyBwbGF0Zm9ybXNcbiAgICAgIC8vIEhhcmQtY29kaW5nIHNpbmNlIHRoaXMgbWV0aG9kIGV4cGxpY2l0bHkgd3JpdGVzIHRvIHRoZSBzYW1lIGRpcmVjdG9yeSBpZiB0eXBlcyBhcmUgZW5hYmxlZC5cbiAgICAgIGdlbmVyYXRlTW9kZWxzUGFyYW1zLnJlbGF0aXZlVHlwZXNQYXRoID0gYC4vJHtmaWxlTmFtZX1gO1xuICAgIH1cbiAgICBjb25zdCBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLmdyYXBocWxEb2N1bWVudEdlbmVyYXRvci5nZW5lcmF0ZU1vZGVscyhcbiAgICAgIGdlbmVyYXRlTW9kZWxzUGFyYW1zXG4gICAgKTtcblxuICAgIGlmIChwcm9wcy50eXBlVGFyZ2V0KSB7XG4gICAgICBjb25zdCB0eXBlcyA9IGF3YWl0IHRoaXMuZ3JhcGhxbFR5cGVzR2VuZXJhdG9yLmdlbmVyYXRlVHlwZXMoe1xuICAgICAgICB0YXJnZXQ6IHByb3BzLnR5cGVUYXJnZXQsXG4gICAgICAgIG11bHRpcGxlU3dpZnRGaWxlczogcHJvcHMubXVsdGlwbGVTd2lmdEZpbGVzLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdyaXRlVG9EaXJlY3Rvcnk6IGFzeW5jIChkaXJlY3RvcnlQYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICBkb2N1bWVudHMud3JpdGVUb0RpcmVjdG9yeShkaXJlY3RvcnlQYXRoKSxcbiAgICAgICAgICAgIHR5cGVzLndyaXRlVG9EaXJlY3RvcnkoZGlyZWN0b3J5UGF0aCksXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFJlc3VsdHM6IGFzeW5jICgpID0+ICh7XG4gICAgICAgICAgLi4uKGF3YWl0IGRvY3VtZW50cy5nZXRSZXN1bHRzKCkpLFxuICAgICAgICAgIC4uLihhd2FpdCB0eXBlcy5nZXRSZXN1bHRzKCkpLFxuICAgICAgICB9KSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGRvY3VtZW50cztcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIG1vZGVsIGdlbmVyYXRpb24gd2l0aCBtb2RlbCB0YXJnZXQuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlTW9kZWxnZW5BcGlDb2RlKFxuICAgIHByb3BzOiBHZW5lcmF0ZU1vZGVsc09wdGlvbnNcbiAgKTogUHJvbWlzZTxHZW5lcmF0aW9uUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuZ3JhcGhxbE1vZGVsc0dlbmVyYXRvci5nZW5lcmF0ZU1vZGVscyh7XG4gICAgICB0YXJnZXQ6IHByb3BzLm1vZGVsVGFyZ2V0LFxuICAgICAgZ2VuZXJhdGVJbmRleFJ1bGVzOiBwcm9wcy5nZW5lcmF0ZUluZGV4UnVsZXMsXG4gICAgICBlbWl0QXV0aFByb3ZpZGVyOiBwcm9wcy5lbWl0QXV0aFByb3ZpZGVyLFxuICAgICAgdXNlRXhwZXJpbWVudGFsUGlwZWxpbmVkVHJhbnNmb3JtZXI6XG4gICAgICAgIHByb3BzLnVzZUV4cGVyaW1lbnRhbFBpcGVsaW5lZFRyYW5zZm9ybWVyLFxuICAgICAgdHJhbnNmb3JtZXJWZXJzaW9uOiBwcm9wcy50cmFuc2Zvcm1lclZlcnNpb24sXG4gICAgICByZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZDpcbiAgICAgICAgcHJvcHMucmVzcGVjdFByaW1hcnlLZXlBdHRyaWJ1dGVzT25Db25uZWN0aW9uRmllbGQsXG4gICAgICBnZW5lcmF0ZU1vZGVsc0ZvckxhenlMb2FkQW5kQ3VzdG9tU2VsZWN0aW9uU2V0OlxuICAgICAgICBwcm9wcy5nZW5lcmF0ZU1vZGVsc0ZvckxhenlMb2FkQW5kQ3VzdG9tU2VsZWN0aW9uU2V0LFxuICAgICAgYWRkVGltZXN0YW1wRmllbGRzOiBwcm9wcy5hZGRUaW1lc3RhbXBGaWVsZHMsXG4gICAgICBoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5OlxuICAgICAgICBwcm9wcy5oYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgbW9kZWwgZ2VuZXJhdGlvbiB3aXRoIGludHJvc3BlY3Rpb24gdGFyZ2V0LlxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZUludHJvc3BlY3Rpb25BcGlDb2RlKCk6IFByb21pc2U8R2VuZXJhdGlvblJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLmdyYXBocWxNb2RlbHNHZW5lcmF0b3IuZ2VuZXJhdGVNb2RlbHMoe1xuICAgICAgdGFyZ2V0OiAnaW50cm9zcGVjdGlvbicsXG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==