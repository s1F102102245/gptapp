"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AmplifyAuth = void 0;
const constructs_1 = require("constructs");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_cognito_1 = require("aws-cdk-lib/aws-cognito");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
const backend_output_schemas_1 = require("@aws-amplify/backend-output-schemas");
const defaults_js_1 = require("./defaults.js");
const backend_output_storage_1 = require("@aws-amplify/backend-output-storage");
const path = __importStar(require("path"));
const string_maps_js_1 = require("./string_maps.js");
const authProvidersList = {
    facebook: 'graph.facebook.com',
    google: 'accounts.google.com',
    amazon: 'www.amazon.com',
    apple: 'appleid.apple.com',
};
const VERIFICATION_EMAIL_PLACEHOLDERS = {
    CODE: '{####}',
    LINK: '{##Verify Email##}',
};
const VERIFICATION_SMS_PLACEHOLDERS = {
    CODE: '{####}',
};
const MFA_SMS_PLACEHOLDERS = {
    CODE: '{####}',
};
// Be very careful editing this value. It is the string that is used to attribute stacks to Amplify Auth in BI metrics
const authStackType = 'auth-Cognito';
/**
 * Amplify Auth CDK Construct
 */
class AmplifyAuth extends constructs_1.Construct {
    /**
     * Create a new Auth construct with AuthProps.
     * If no props are provided, email login and defaults will be used.
     */
    constructor(scope, id, props = defaults_js_1.DEFAULTS.IF_NO_PROPS_PROVIDED) {
        super(scope, id);
        /**
         * Create Auth/UnAuth Roles
         * @returns DefaultRoles
         */
        this.setupAuthAndUnAuthRoles = (identityPoolId) => {
            const result = {
                auth: new aws_iam_1.Role(this, 'authenticatedUserRole', {
                    assumedBy: new aws_iam_1.FederatedPrincipal('cognito-identity.amazonaws.com', {
                        StringEquals: {
                            'cognito-identity.amazonaws.com:aud': identityPoolId,
                        },
                        'ForAnyValue:StringLike': {
                            'cognito-identity.amazonaws.com:amr': 'authenticated',
                        },
                    }, 'sts:AssumeRoleWithWebIdentity'),
                }),
                unAuth: new aws_iam_1.Role(this, 'unauthenticatedUserRole', {
                    assumedBy: new aws_iam_1.FederatedPrincipal('cognito-identity.amazonaws.com', {
                        StringEquals: {
                            'cognito-identity.amazonaws.com:aud': identityPoolId,
                        },
                        'ForAnyValue:StringLike': {
                            'cognito-identity.amazonaws.com:amr': 'unauthenticated',
                        },
                    }, 'sts:AssumeRoleWithWebIdentity'),
                }),
            };
            return result;
        };
        /**
         * Setup Identity Pool with default roles/role mappings, and register providers
         */
        this.setupIdentityPool = (userPool, userPoolClient, providerSetupResult) => {
            // setup identity pool
            const region = aws_cdk_lib_1.Stack.of(this).region;
            const identityPool = new aws_cdk_lib_1.aws_cognito.CfnIdentityPool(this, 'IdentityPool', {
                allowUnauthenticatedIdentities: defaults_js_1.DEFAULTS.ALLOW_UNAUTHENTICATED_IDENTITIES,
            });
            const roles = this.setupAuthAndUnAuthRoles(identityPool.ref);
            const identityPoolRoleAttachment = new aws_cdk_lib_1.aws_cognito.CfnIdentityPoolRoleAttachment(this, 'IdentityPoolRoleAttachment', {
                identityPoolId: identityPool.ref,
                roles: {
                    unauthenticated: roles.unAuth.roleArn,
                    authenticated: roles.auth.roleArn,
                },
                roleMappings: {
                    UserPoolWebClientRoleMapping: {
                        type: 'Token',
                        ambiguousRoleResolution: 'AuthenticatedRole',
                        identityProvider: `cognito-idp.${region}.amazonaws.com/${userPool.userPoolId}:${userPoolClient.userPoolClientId}`,
                    },
                },
            });
            identityPoolRoleAttachment.addDependency(identityPool);
            identityPoolRoleAttachment.node.addDependency(userPoolClient);
            // add cognito provider
            identityPool.cognitoIdentityProviders = [
                {
                    clientId: userPoolClient.userPoolClientId,
                    providerName: `cognito-idp.${region}.amazonaws.com/${userPool.userPoolId}`,
                },
            ];
            // add other providers
            identityPool.supportedLoginProviders = providerSetupResult.oauthMappings;
            if (providerSetupResult.oidc) {
                identityPool.openIdConnectProviderArns = [
                    `arn:${region}:iam::${aws_cdk_lib_1.Stack.of(this).account}:oidc-provider/cognito-idp.${region}.amazonaws.com/${providerSetupResult.oidc.providerName}`,
                ];
            }
            if (providerSetupResult.saml) {
                identityPool.samlProviderArns = [
                    `arn:${region}:iam::${aws_cdk_lib_1.Stack.of(this).account}:saml-provider/${providerSetupResult.saml.providerName}`,
                ];
            }
            return {
                identityPool,
                identityPoolRoleAttachment,
                roles,
            };
        };
        /**
         * Process props into UserPoolProps (set defaults if needed)
         */
        this.getUserPoolProps = (props) => {
            const emailEnabled = props.loginWith.email ? true : false;
            const phoneEnabled = props.loginWith.phone ? true : false;
            const oneOfEmailOrPhone = emailEnabled || phoneEnabled;
            if (!oneOfEmailOrPhone) {
                throw Error('At least one of email or phone must be enabled.');
            }
            let userVerificationSettings = {};
            // extract email settings if settings object is defined
            if (typeof props.loginWith.email === 'object') {
                const emailSettings = props.loginWith.email;
                // verify email body and inject the actual template values which cognito uses
                const emailBody = this.verifyEmailBody(emailSettings);
                userVerificationSettings = {
                    emailBody: emailBody,
                    emailStyle: this.getEmailVerificationStyle(emailSettings.verificationEmailStyle),
                    emailSubject: emailSettings.verificationEmailSubject,
                };
            }
            // extract phone settings if settings object is defined
            if (typeof props.loginWith.phone === 'object') {
                const phoneSettings = props.loginWith.phone;
                let smsMessage;
                if (phoneSettings.verificationMessage &&
                    typeof phoneSettings.verificationMessage === 'function') {
                    // validate sms message structure
                    smsMessage = phoneSettings.verificationMessage(VERIFICATION_SMS_PLACEHOLDERS.CODE);
                    if (!smsMessage.includes(VERIFICATION_SMS_PLACEHOLDERS.CODE)) {
                        throw Error("Invalid phone settings. Property 'verificationMessage' must utilize the 'code' parameter at least once as a placeholder for the verification code.");
                    }
                }
                userVerificationSettings = {
                    ...userVerificationSettings,
                    smsMessage: smsMessage,
                };
            }
            const userPoolProps = {
                signInCaseSensitive: defaults_js_1.DEFAULTS.SIGN_IN_CASE_SENSITIVE,
                signInAliases: {
                    phone: phoneEnabled,
                    email: emailEnabled,
                },
                keepOriginal: {
                    email: emailEnabled,
                    phone: phoneEnabled,
                },
                autoVerify: {
                    email: emailEnabled,
                    phone: phoneEnabled,
                },
                userVerification: userVerificationSettings,
                passwordPolicy: defaults_js_1.DEFAULTS.PASSWORD_POLICY,
                standardAttributes: {
                    email: defaults_js_1.DEFAULTS.IS_REQUIRED_ATTRIBUTE.email(emailEnabled),
                    phoneNumber: defaults_js_1.DEFAULTS.IS_REQUIRED_ATTRIBUTE.phoneNumber(phoneEnabled),
                    ...(props.userAttributes ? props.userAttributes : {}),
                },
                selfSignUpEnabled: defaults_js_1.DEFAULTS.ALLOW_SELF_SIGN_UP,
                mfa: this.getMFAMode(props.multifactor),
                mfaMessage: this.getMFAMessage(props.multifactor),
                mfaSecondFactor: typeof props.multifactor === 'object' &&
                    props.multifactor.mode !== 'OFF'
                    ? {
                        sms: props.multifactor.sms ? true : false,
                        otp: props.multifactor.totp ? true : false,
                    }
                    : undefined,
                accountRecovery: this.getAccountRecoverySetting(emailEnabled, phoneEnabled, props.accountRecovery),
                removalPolicy: aws_cdk_lib_1.RemovalPolicy.DESTROY,
            };
            return userPoolProps;
        };
        /**
         * Get email verification style from user props
         * @param verificationEmailStyle - string value
         * @returns verificationEmailStyle - enum value
         */
        this.getEmailVerificationStyle = (verificationEmailStyle) => {
            if (verificationEmailStyle === 'CODE') {
                return aws_cdk_lib_1.aws_cognito.VerificationEmailStyle.CODE;
            }
            else if (verificationEmailStyle === 'LINK') {
                return aws_cdk_lib_1.aws_cognito.VerificationEmailStyle.LINK;
            }
            return undefined;
        };
        /**
         * Determine the account recovery option based on enabled login methods.
         * @param emailEnabled - is email enabled
         * @param phoneEnabled - is phone enabled
         * @param accountRecoveryMethodAsString - the user provided account recovery setting
         * @returns account recovery setting enum value
         */
        this.getAccountRecoverySetting = (emailEnabled, phoneEnabled, accountRecoveryMethodAsString) => {
            const accountRecovery = this.convertAccountRecoveryStringToEnum(accountRecoveryMethodAsString);
            if (accountRecovery !== undefined) {
                return accountRecovery;
            }
            // set default based on enabled login methods
            if (phoneEnabled && emailEnabled) {
                return aws_cdk_lib_1.aws_cognito.AccountRecovery.EMAIL_ONLY;
            }
            if (phoneEnabled) {
                return aws_cdk_lib_1.aws_cognito.AccountRecovery.PHONE_ONLY_WITHOUT_MFA;
            }
            if (emailEnabled) {
                return aws_cdk_lib_1.aws_cognito.AccountRecovery.EMAIL_ONLY;
            }
            return undefined;
        };
        /**
         * Convert user friendly Mfa mode to cognito Mfa type.
         * This eliminates the need for users to import cognito.Mfa.
         * @param mfa - MFA settings
         * @returns cognito MFA enforcement type
         */
        this.getMFAMode = (mfa) => {
            if (mfa) {
                switch (mfa.mode) {
                    case 'OFF':
                        return aws_cognito_1.Mfa.OFF;
                    case 'OPTIONAL':
                        return aws_cognito_1.Mfa.OPTIONAL;
                    case 'REQUIRED':
                        return aws_cognito_1.Mfa.REQUIRED;
                }
            }
            return undefined;
        };
        /**
         * Convert user friendly account recovery method to cognito AccountRecover enum.
         * This eliminates the need for users to import cognito.AccountRecovery.
         * @param method - account recovery method as a string value
         * @returns cognito.AccountRecovery enum value
         */
        this.convertAccountRecoveryStringToEnum = (method) => {
            if (method !== undefined) {
                return aws_cdk_lib_1.aws_cognito.AccountRecovery[method];
            }
            return undefined;
        };
        /**
         * Extract the MFA message settings and perform validation.
         * @param mfa - MFA settings
         * @returns mfa message
         */
        this.getMFAMessage = (mfa) => {
            if (mfa && mfa.mode !== 'OFF' && typeof mfa.sms === 'object') {
                const message = mfa.sms.smsMessage(MFA_SMS_PLACEHOLDERS.CODE);
                if (!message.includes(MFA_SMS_PLACEHOLDERS.CODE)) {
                    throw Error("Invalid MFA settings. Property 'smsMessage' must utilize the 'code' parameter at least once as a placeholder for the verification code.");
                }
                return message;
            }
            return undefined;
        };
        /**
         * Setup Identity Providers (OAuth/OIDC/SAML)
         */
        this.setupIdentityProviders = (userPool, loginOptions) => {
            const result = {
                oauthMappings: {},
            };
            // external providers
            const external = loginOptions.externalProviders;
            if (!external) {
                return result;
            }
            if (external.google) {
                const googleProps = external.google;
                result.google = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderGoogle(this, 'GoogleIdP', {
                    userPool,
                    clientId: googleProps.clientId,
                    clientSecretValue: googleProps.clientSecret,
                    attributeMapping: googleProps.attributeMapping,
                    scopes: googleProps.scopes,
                });
                result.oauthMappings[authProvidersList.google] = external.google.clientId;
            }
            if (external.facebook) {
                result.facebook = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderFacebook(this, 'FacebookIDP', {
                    userPool,
                    ...external.facebook,
                });
                result.oauthMappings[authProvidersList.facebook] =
                    external.facebook.clientId;
            }
            if (external.loginWithAmazon) {
                result.amazon = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderAmazon(this, 'AmazonIDP', {
                    userPool,
                    ...external.loginWithAmazon,
                });
                result.oauthMappings[authProvidersList.amazon] =
                    external.loginWithAmazon.clientId;
            }
            if (external.signInWithApple) {
                result.apple = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderApple(this, 'AppleIDP', {
                    userPool,
                    ...external.signInWithApple,
                });
                result.oauthMappings[authProvidersList.apple] =
                    external.signInWithApple.clientId;
            }
            if (external.oidc) {
                result.oidc = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderOidc(this, 'OidcIDP', {
                    userPool,
                    ...external.oidc,
                });
            }
            if (external.saml) {
                result.saml = new aws_cdk_lib_1.aws_cognito.UserPoolIdentityProviderSaml(this, 'SamlIDP', {
                    userPool,
                    ...external.saml,
                });
            }
            return result;
        };
        /**
         * Convert scopes from string list to OAuthScopes.
         * @param scopes - scope list
         * @returns cognito OAuthScopes
         */
        this.getOAuthScopes = (scopes) => {
            if (scopes === undefined) {
                return [];
            }
            const result = [];
            for (const scope of scopes) {
                result.push(aws_cdk_lib_1.aws_cognito.OAuthScope[scope]);
            }
            return result;
        };
        /**
         * Stores auth output using the provided strategy
         */
        this.storeOutput = (outputStorageStrategy = new backend_output_storage_1.StackMetadataBackendOutputStorageStrategy(aws_cdk_lib_1.Stack.of(this))) => {
            var _a, _b, _c;
            const output = {
                userPoolId: this.resources.userPool.userPoolId,
                webClientId: this.resources.userPoolClient.userPoolClientId,
                identityPoolId: this.resources.cfnResources.cfnIdentityPool.ref,
                authRegion: aws_cdk_lib_1.Stack.of(this).region,
            };
            if (this.computedUserPoolProps.standardAttributes) {
                const signupAttributes = Object.entries(this.computedUserPoolProps.standardAttributes).reduce((acc, [attributeName, attribute]) => {
                    if (attribute === null || attribute === void 0 ? void 0 : attribute.required) {
                        const treatedAttributeName = string_maps_js_1.coreAttributeNameMap.find(({ standardAttributeName }) => standardAttributeName === attributeName);
                        if (treatedAttributeName) {
                            return [
                                ...acc,
                                treatedAttributeName.userpoolAttributeName.toUpperCase(),
                            ];
                        }
                    }
                    return acc;
                }, []);
                output.signupAttributes = JSON.stringify(signupAttributes);
            }
            if (this.computedUserPoolProps.signInAliases) {
                const usernameAttributes = [];
                if (this.computedUserPoolProps.signInAliases.email) {
                    usernameAttributes.push('EMAIL');
                }
                if (this.computedUserPoolProps.signInAliases.phone) {
                    usernameAttributes.push('PHONE_NUMBER');
                }
                if (this.computedUserPoolProps.signInAliases.preferredUsername ||
                    this.computedUserPoolProps.signInAliases.username) {
                    usernameAttributes.push('PREFERRED_USERNAME');
                }
                if (usernameAttributes.length > 0) {
                    output.usernameAttributes = JSON.stringify(usernameAttributes);
                }
            }
            if (this.computedUserPoolProps.autoVerify) {
                const verificationMechanisms = [];
                if (this.computedUserPoolProps.autoVerify.email) {
                    verificationMechanisms.push('EMAIL');
                }
                if (this.computedUserPoolProps.autoVerify.phone) {
                    verificationMechanisms.push('PHONE');
                }
                if (verificationMechanisms.length > 0) {
                    output.verificationMechanisms = JSON.stringify(verificationMechanisms);
                }
            }
            if (this.computedUserPoolProps.passwordPolicy) {
                output.passwordPolicyMinLength =
                    (_a = this.computedUserPoolProps.passwordPolicy.minLength) === null || _a === void 0 ? void 0 : _a.toString();
                const requirements = [];
                if (this.computedUserPoolProps.passwordPolicy.requireDigits) {
                    requirements.push('REQUIRES_NUMBERS');
                }
                if (this.computedUserPoolProps.passwordPolicy.requireLowercase) {
                    requirements.push('REQUIRES_LOWERCASE');
                }
                if (this.computedUserPoolProps.passwordPolicy.requireUppercase) {
                    requirements.push('REQUIRES_UPPERCASE');
                }
                if (this.computedUserPoolProps.passwordPolicy.requireSymbols) {
                    requirements.push('REQUIRES_SYMBOLS');
                }
                if (requirements.length > 0) {
                    output.passwordPolicyRequirements = JSON.stringify(requirements);
                }
            }
            if (this.computedUserPoolProps.mfa) {
                output.mfaConfiguration = this.computedUserPoolProps.mfa;
                const mfaTypes = [];
                if ((_b = this.computedUserPoolProps.mfaSecondFactor) === null || _b === void 0 ? void 0 : _b.otp) {
                    mfaTypes.push('TOTP');
                }
                if ((_c = this.computedUserPoolProps.mfaSecondFactor) === null || _c === void 0 ? void 0 : _c.sms) {
                    mfaTypes.push('SMS');
                }
                if (mfaTypes.length > 0) {
                    output.mfaTypes = JSON.stringify(mfaTypes);
                }
            }
            if (this.oauthMappings[authProvidersList.amazon]) {
                output.amazonClientId = this.oauthMappings[authProvidersList.amazon];
            }
            if (this.oauthMappings[authProvidersList.facebook]) {
                output.facebookClientId = this.oauthMappings[authProvidersList.facebook];
            }
            if (this.oauthMappings[authProvidersList.google]) {
                output.googleClientId = this.oauthMappings[authProvidersList.google];
            }
            if (this.oauthMappings[authProvidersList.apple]) {
                output.appleClientId = this.oauthMappings[authProvidersList.apple];
            }
            outputStorageStrategy.addBackendOutputEntry(backend_output_schemas_1.authOutputKey, {
                version: '1',
                payload: output,
            });
        };
        /**
         * Attach a Lambda function trigger handler to the UserPool in this construct
         * @param event - The trigger event operation
         * @param handler - The function that will handle the event
         */
        this.addTrigger = (event, handler) => {
            if ('resources' in handler) {
                this.userPool.addTrigger(aws_cognito_1.UserPoolOperation.of(event), handler.resources.lambda);
            }
            else {
                // handler is an IFunction
                this.userPool.addTrigger(aws_cognito_1.UserPoolOperation.of(event), handler);
            }
        };
        // UserPool
        this.computedUserPoolProps = this.getUserPoolProps(props);
        this.userPool = new aws_cdk_lib_1.aws_cognito.UserPool(this, 'UserPool', this.computedUserPoolProps);
        // UserPool - Identity Providers
        const providerSetupResult = this.setupIdentityProviders(this.userPool, props.loginWith);
        this.oauthMappings = providerSetupResult.oauthMappings;
        // UserPool Client
        const externalProviders = props.loginWith.externalProviders;
        const userPoolClient = new aws_cdk_lib_1.aws_cognito.UserPoolClient(this, 'UserPoolAppClient', {
            userPool: this.userPool,
            authFlows: defaults_js_1.DEFAULTS.AUTH_FLOWS,
            preventUserExistenceErrors: defaults_js_1.DEFAULTS.PREVENT_USER_EXISTENCE_ERRORS,
            oAuth: {
                ...((externalProviders === null || externalProviders === void 0 ? void 0 : externalProviders.callbackUrls)
                    ? { callbackUrls: externalProviders.callbackUrls }
                    : {}),
                ...((externalProviders === null || externalProviders === void 0 ? void 0 : externalProviders.logoutUrls)
                    ? { logoutUrls: externalProviders.logoutUrls }
                    : {}),
                ...((externalProviders === null || externalProviders === void 0 ? void 0 : externalProviders.scopes)
                    ? { scopes: this.getOAuthScopes(externalProviders.scopes) }
                    : {}),
            },
        });
        // Identity Pool
        const { identityPool, identityPoolRoleAttachment, roles: { auth, unAuth }, } = this.setupIdentityPool(this.userPool, userPoolClient, providerSetupResult);
        // expose resources
        this.resources = {
            userPool: this.userPool,
            userPoolClient,
            authenticatedUserIamRole: auth,
            unauthenticatedUserIamRole: unAuth,
            cfnResources: {
                cfnUserPool: this.userPool.node.findChild('Resource'),
                cfnUserPoolClient: userPoolClient.node.findChild('Resource'),
                cfnIdentityPool: identityPool,
                cfnIdentityPoolRoleAttachment: identityPoolRoleAttachment,
            },
        };
        this.storeOutput(props.outputStorageStrategy);
        new backend_output_storage_1.AttributionMetadataStorage().storeAttributionMetadata(aws_cdk_lib_1.Stack.of(this), authStackType, path.resolve(__dirname, '..', 'package.json'));
    }
    /**
     * Verify the email body depending on if 'CODE' or 'LINK' style is used.
     * This ensures that the template contains the necessary placeholders for Cognito to insert verification codes or links.
     * @param emailSettings the provided email settings
     * @returns emailBody
     */
    verifyEmailBody(emailSettings) {
        let emailBody;
        if (emailSettings.verificationEmailBody &&
            emailSettings.verificationEmailStyle !== 'LINK') {
            emailBody = emailSettings.verificationEmailBody(VERIFICATION_EMAIL_PLACEHOLDERS.CODE);
            if (!emailBody.includes(VERIFICATION_EMAIL_PLACEHOLDERS.CODE)) {
                throw Error("Invalid email settings. Property 'verificationEmailBody' must utilize the 'code' parameter at least once as a placeholder for the verification code.");
            }
        }
        if (emailSettings.verificationEmailBody &&
            emailSettings.verificationEmailStyle === 'LINK') {
            emailBody = emailSettings.verificationEmailBody(VERIFICATION_EMAIL_PLACEHOLDERS.LINK);
            if (!emailBody.includes(VERIFICATION_EMAIL_PLACEHOLDERS.LINK)) {
                throw Error("Invalid email settings. Property 'verificationEmailBody' must utilize the 'link' parameter at least once as a placeholder for the verification link.");
            }
        }
        return emailBody;
    }
}
exports.AmplifyAuth = AmplifyAuth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uc3RydWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbnN0cnVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUF1QztBQUN2Qyw2Q0FBMkU7QUFPM0UseURBY2lDO0FBQ2pDLGlEQUErRDtBQUMvRCxnRkFBZ0Y7QUFPaEYsK0NBQXlDO0FBRXpDLGdGQUc2QztBQUM3QywyQ0FBNkI7QUFDN0IscURBQXdEO0FBWXhELE1BQU0saUJBQWlCLEdBQUc7SUFDeEIsUUFBUSxFQUFFLG9CQUFvQjtJQUM5QixNQUFNLEVBQUUscUJBQXFCO0lBQzdCLE1BQU0sRUFBRSxnQkFBZ0I7SUFDeEIsS0FBSyxFQUFFLG1CQUFtQjtDQUMzQixDQUFDO0FBQ0YsTUFBTSwrQkFBK0IsR0FBRztJQUN0QyxJQUFJLEVBQUUsUUFBUTtJQUNkLElBQUksRUFBRSxvQkFBb0I7Q0FDM0IsQ0FBQztBQUNGLE1BQU0sNkJBQTZCLEdBQUc7SUFDcEMsSUFBSSxFQUFFLFFBQVE7Q0FDZixDQUFDO0FBQ0YsTUFBTSxvQkFBb0IsR0FBRztJQUMzQixJQUFJLEVBQUUsUUFBUTtDQUNmLENBQUM7QUFFRixzSEFBc0g7QUFDdEgsTUFBTSxhQUFhLEdBQUcsY0FBYyxDQUFDO0FBRXJDOztHQUVHO0FBQ0gsTUFBYSxXQUNYLFNBQVEsc0JBQVM7SUFnQmpCOzs7T0FHRztJQUNILFlBQ0UsS0FBZ0IsRUFDaEIsRUFBVSxFQUNWLFFBQW1CLHNCQUFRLENBQUMsb0JBQW9CO1FBRWhELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUEyRW5COzs7V0FHRztRQUNLLDRCQUF1QixHQUFHLENBQUMsY0FBc0IsRUFBZ0IsRUFBRTtZQUN6RSxNQUFNLE1BQU0sR0FBaUI7Z0JBQzNCLElBQUksRUFBRSxJQUFJLGNBQUksQ0FBQyxJQUFJLEVBQUUsdUJBQXVCLEVBQUU7b0JBQzVDLFNBQVMsRUFBRSxJQUFJLDRCQUFrQixDQUMvQixnQ0FBZ0MsRUFDaEM7d0JBQ0UsWUFBWSxFQUFFOzRCQUNaLG9DQUFvQyxFQUFFLGNBQWM7eUJBQ3JEO3dCQUNELHdCQUF3QixFQUFFOzRCQUN4QixvQ0FBb0MsRUFBRSxlQUFlO3lCQUN0RDtxQkFDRixFQUNELCtCQUErQixDQUNoQztpQkFDRixDQUFDO2dCQUNGLE1BQU0sRUFBRSxJQUFJLGNBQUksQ0FBQyxJQUFJLEVBQUUseUJBQXlCLEVBQUU7b0JBQ2hELFNBQVMsRUFBRSxJQUFJLDRCQUFrQixDQUMvQixnQ0FBZ0MsRUFDaEM7d0JBQ0UsWUFBWSxFQUFFOzRCQUNaLG9DQUFvQyxFQUFFLGNBQWM7eUJBQ3JEO3dCQUNELHdCQUF3QixFQUFFOzRCQUN4QixvQ0FBb0MsRUFBRSxpQkFBaUI7eUJBQ3hEO3FCQUNGLEVBQ0QsK0JBQStCLENBQ2hDO2lCQUNGLENBQUM7YUFDSCxDQUFDO1lBQ0YsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxDQUFDO1FBRUY7O1dBRUc7UUFDSyxzQkFBaUIsR0FBRyxDQUMxQixRQUFrQixFQUNsQixjQUE4QixFQUM5QixtQkFBZ0QsRUFDaEQsRUFBRTtZQUNGLHNCQUFzQjtZQUN0QixNQUFNLE1BQU0sR0FBRyxtQkFBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDckMsTUFBTSxZQUFZLEdBQUcsSUFBSSx5QkFBTyxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsY0FBYyxFQUFFO2dCQUNyRSw4QkFBOEIsRUFBRSxzQkFBUSxDQUFDLGdDQUFnQzthQUMxRSxDQUFDLENBQUM7WUFDSCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdELE1BQU0sMEJBQTBCLEdBQzlCLElBQUkseUJBQU8sQ0FBQyw2QkFBNkIsQ0FDdkMsSUFBSSxFQUNKLDRCQUE0QixFQUM1QjtnQkFDRSxjQUFjLEVBQUUsWUFBWSxDQUFDLEdBQUc7Z0JBQ2hDLEtBQUssRUFBRTtvQkFDTCxlQUFlLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPO29CQUNyQyxhQUFhLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPO2lCQUNsQztnQkFDRCxZQUFZLEVBQUU7b0JBQ1osNEJBQTRCLEVBQUU7d0JBQzVCLElBQUksRUFBRSxPQUFPO3dCQUNiLHVCQUF1QixFQUFFLG1CQUFtQjt3QkFDNUMsZ0JBQWdCLEVBQUUsZUFBZSxNQUFNLGtCQUFrQixRQUFRLENBQUMsVUFBVSxJQUFJLGNBQWMsQ0FBQyxnQkFBZ0IsRUFBRTtxQkFDbEg7aUJBQ0Y7YUFDRixDQUNGLENBQUM7WUFDSiwwQkFBMEIsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDdkQsMEJBQTBCLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUM5RCx1QkFBdUI7WUFDdkIsWUFBWSxDQUFDLHdCQUF3QixHQUFHO2dCQUN0QztvQkFDRSxRQUFRLEVBQUUsY0FBYyxDQUFDLGdCQUFnQjtvQkFDekMsWUFBWSxFQUFFLGVBQWUsTUFBTSxrQkFBa0IsUUFBUSxDQUFDLFVBQVUsRUFBRTtpQkFDM0U7YUFDRixDQUFDO1lBQ0Ysc0JBQXNCO1lBQ3RCLFlBQVksQ0FBQyx1QkFBdUIsR0FBRyxtQkFBbUIsQ0FBQyxhQUFhLENBQUM7WUFDekUsSUFBSSxtQkFBbUIsQ0FBQyxJQUFJLEVBQUU7Z0JBQzVCLFlBQVksQ0FBQyx5QkFBeUIsR0FBRztvQkFDdkMsT0FBTyxNQUFNLFNBQ1gsbUJBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsT0FDakIsOEJBQThCLE1BQU0sa0JBQ2xDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxZQUMzQixFQUFFO2lCQUNILENBQUM7YUFDSDtZQUNELElBQUksbUJBQW1CLENBQUMsSUFBSSxFQUFFO2dCQUM1QixZQUFZLENBQUMsZ0JBQWdCLEdBQUc7b0JBQzlCLE9BQU8sTUFBTSxTQUFTLG1CQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sa0JBQzFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxZQUMzQixFQUFFO2lCQUNILENBQUM7YUFDSDtZQUNELE9BQU87Z0JBQ0wsWUFBWTtnQkFDWiwwQkFBMEI7Z0JBQzFCLEtBQUs7YUFDTixDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBRUY7O1dBRUc7UUFDSyxxQkFBZ0IsR0FBRyxDQUFDLEtBQWdCLEVBQWlCLEVBQUU7WUFDN0QsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQzFELE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUMxRCxNQUFNLGlCQUFpQixHQUFHLFlBQVksSUFBSSxZQUFZLENBQUM7WUFDdkQsSUFBSSxDQUFDLGlCQUFpQixFQUFFO2dCQUN0QixNQUFNLEtBQUssQ0FBQyxpREFBaUQsQ0FBQyxDQUFDO2FBQ2hFO1lBQ0QsSUFBSSx3QkFBd0IsR0FBbUMsRUFBRSxDQUFDO1lBQ2xFLHVEQUF1RDtZQUN2RCxJQUFJLE9BQU8sS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEtBQUssUUFBUSxFQUFFO2dCQUM3QyxNQUFNLGFBQWEsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztnQkFDNUMsNkVBQTZFO2dCQUM3RSxNQUFNLFNBQVMsR0FBdUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLENBQUMsQ0FBQztnQkFDMUUsd0JBQXdCLEdBQUc7b0JBQ3pCLFNBQVMsRUFBRSxTQUFTO29CQUNwQixVQUFVLEVBQUUsSUFBSSxDQUFDLHlCQUF5QixDQUN4QyxhQUFhLENBQUMsc0JBQXNCLENBQ3JDO29CQUNELFlBQVksRUFBRSxhQUFhLENBQUMsd0JBQXdCO2lCQUNyRCxDQUFDO2FBQ0g7WUFDRCx1REFBdUQ7WUFDdkQsSUFBSSxPQUFPLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxLQUFLLFFBQVEsRUFBRTtnQkFDN0MsTUFBTSxhQUFhLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7Z0JBQzVDLElBQUksVUFBOEIsQ0FBQztnQkFDbkMsSUFDRSxhQUFhLENBQUMsbUJBQW1CO29CQUNqQyxPQUFPLGFBQWEsQ0FBQyxtQkFBbUIsS0FBSyxVQUFVLEVBQ3ZEO29CQUNBLGlDQUFpQztvQkFDakMsVUFBVSxHQUFHLGFBQWEsQ0FBQyxtQkFBbUIsQ0FDNUMsNkJBQTZCLENBQUMsSUFBSSxDQUNuQyxDQUFDO29CQUNGLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLDZCQUE2QixDQUFDLElBQUksQ0FBQyxFQUFFO3dCQUM1RCxNQUFNLEtBQUssQ0FDVCxvSkFBb0osQ0FDckosQ0FBQztxQkFDSDtpQkFDRjtnQkFDRCx3QkFBd0IsR0FBRztvQkFDekIsR0FBRyx3QkFBd0I7b0JBQzNCLFVBQVUsRUFBRSxVQUFVO2lCQUN2QixDQUFDO2FBQ0g7WUFDRCxNQUFNLGFBQWEsR0FBa0I7Z0JBQ25DLG1CQUFtQixFQUFFLHNCQUFRLENBQUMsc0JBQXNCO2dCQUNwRCxhQUFhLEVBQUU7b0JBQ2IsS0FBSyxFQUFFLFlBQVk7b0JBQ25CLEtBQUssRUFBRSxZQUFZO2lCQUNwQjtnQkFDRCxZQUFZLEVBQUU7b0JBQ1osS0FBSyxFQUFFLFlBQVk7b0JBQ25CLEtBQUssRUFBRSxZQUFZO2lCQUNwQjtnQkFDRCxVQUFVLEVBQUU7b0JBQ1YsS0FBSyxFQUFFLFlBQVk7b0JBQ25CLEtBQUssRUFBRSxZQUFZO2lCQUNwQjtnQkFDRCxnQkFBZ0IsRUFBRSx3QkFBd0I7Z0JBQzFDLGNBQWMsRUFBRSxzQkFBUSxDQUFDLGVBQWU7Z0JBQ3hDLGtCQUFrQixFQUFFO29CQUNsQixLQUFLLEVBQUUsc0JBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDO29CQUN6RCxXQUFXLEVBQUUsc0JBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDO29CQUNyRSxHQUFHLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO2lCQUN0RDtnQkFDRCxpQkFBaUIsRUFBRSxzQkFBUSxDQUFDLGtCQUFrQjtnQkFDOUMsR0FBRyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQztnQkFDdkMsVUFBVSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQztnQkFDakQsZUFBZSxFQUNiLE9BQU8sS0FBSyxDQUFDLFdBQVcsS0FBSyxRQUFRO29CQUNyQyxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksS0FBSyxLQUFLO29CQUM5QixDQUFDLENBQUM7d0JBQ0UsR0FBRyxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUs7d0JBQ3pDLEdBQUcsRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLO3FCQUMzQztvQkFDSCxDQUFDLENBQUMsU0FBUztnQkFDZixlQUFlLEVBQUUsSUFBSSxDQUFDLHlCQUF5QixDQUM3QyxZQUFZLEVBQ1osWUFBWSxFQUNaLEtBQUssQ0FBQyxlQUFlLENBQ3RCO2dCQUNELGFBQWEsRUFBRSwyQkFBYSxDQUFDLE9BQU87YUFDckMsQ0FBQztZQUNGLE9BQU8sYUFBYSxDQUFDO1FBQ3ZCLENBQUMsQ0FBQztRQXlDRjs7OztXQUlHO1FBQ0ssOEJBQXlCLEdBQUcsQ0FDbEMsc0JBQW1ELEVBQ1AsRUFBRTtZQUM5QyxJQUFJLHNCQUFzQixLQUFLLE1BQU0sRUFBRTtnQkFDckMsT0FBTyx5QkFBTyxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQzthQUM1QztpQkFBTSxJQUFJLHNCQUFzQixLQUFLLE1BQU0sRUFBRTtnQkFDNUMsT0FBTyx5QkFBTyxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQzthQUM1QztZQUNELE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUMsQ0FBQztRQUVGOzs7Ozs7V0FNRztRQUNLLDhCQUF5QixHQUFHLENBQ2xDLFlBQXFCLEVBQ3JCLFlBQXFCLEVBQ3JCLDZCQUEyRCxFQUN0QixFQUFFO1lBQ3ZDLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxrQ0FBa0MsQ0FDN0QsNkJBQTZCLENBQzlCLENBQUM7WUFDRixJQUFJLGVBQWUsS0FBSyxTQUFTLEVBQUU7Z0JBQ2pDLE9BQU8sZUFBZSxDQUFDO2FBQ3hCO1lBQ0QsNkNBQTZDO1lBQzdDLElBQUksWUFBWSxJQUFJLFlBQVksRUFBRTtnQkFDaEMsT0FBTyx5QkFBTyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUM7YUFDM0M7WUFDRCxJQUFJLFlBQVksRUFBRTtnQkFDaEIsT0FBTyx5QkFBTyxDQUFDLGVBQWUsQ0FBQyxzQkFBc0IsQ0FBQzthQUN2RDtZQUNELElBQUksWUFBWSxFQUFFO2dCQUNoQixPQUFPLHlCQUFPLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQzthQUMzQztZQUNELE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUMsQ0FBQztRQUVGOzs7OztXQUtHO1FBQ0ssZUFBVSxHQUFHLENBQUMsR0FBNkIsRUFBbUIsRUFBRTtZQUN0RSxJQUFJLEdBQUcsRUFBRTtnQkFDUCxRQUFRLEdBQUcsQ0FBQyxJQUFJLEVBQUU7b0JBQ2hCLEtBQUssS0FBSzt3QkFDUixPQUFPLGlCQUFHLENBQUMsR0FBRyxDQUFDO29CQUNqQixLQUFLLFVBQVU7d0JBQ2IsT0FBTyxpQkFBRyxDQUFDLFFBQVEsQ0FBQztvQkFDdEIsS0FBSyxVQUFVO3dCQUNiLE9BQU8saUJBQUcsQ0FBQyxRQUFRLENBQUM7aUJBQ3ZCO2FBQ0Y7WUFDRCxPQUFPLFNBQVMsQ0FBQztRQUNuQixDQUFDLENBQUM7UUFFRjs7Ozs7V0FLRztRQUNLLHVDQUFrQyxHQUFHLENBQzNDLE1BQW9DLEVBQ0MsRUFBRTtZQUN2QyxJQUFJLE1BQU0sS0FBSyxTQUFTLEVBQUU7Z0JBQ3hCLE9BQU8seUJBQU8sQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDeEM7WUFDRCxPQUFPLFNBQVMsQ0FBQztRQUNuQixDQUFDLENBQUM7UUFFRjs7OztXQUlHO1FBQ0ssa0JBQWEsR0FBRyxDQUN0QixHQUE2QixFQUNULEVBQUU7WUFDdEIsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxLQUFLLElBQUksT0FBTyxHQUFHLENBQUMsR0FBRyxLQUFLLFFBQVEsRUFBRTtnQkFDNUQsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlELElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxFQUFFO29CQUNoRCxNQUFNLEtBQUssQ0FDVCx5SUFBeUksQ0FDMUksQ0FBQztpQkFDSDtnQkFDRCxPQUFPLE9BQU8sQ0FBQzthQUNoQjtZQUNELE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUMsQ0FBQztRQUVGOztXQUVHO1FBQ0ssMkJBQXNCLEdBQUcsQ0FDL0IsUUFBa0IsRUFDbEIsWUFBb0MsRUFDUCxFQUFFO1lBQy9CLE1BQU0sTUFBTSxHQUFnQztnQkFDMUMsYUFBYSxFQUFFLEVBQUU7YUFDbEIsQ0FBQztZQUNGLHFCQUFxQjtZQUNyQixNQUFNLFFBQVEsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUM7WUFDaEQsSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDYixPQUFPLE1BQU0sQ0FBQzthQUNmO1lBQ0QsSUFBSSxRQUFRLENBQUMsTUFBTSxFQUFFO2dCQUNuQixNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO2dCQUNwQyxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUkseUJBQU8sQ0FBQyw4QkFBOEIsQ0FDeEQsSUFBSSxFQUNKLFdBQVcsRUFDWDtvQkFDRSxRQUFRO29CQUNSLFFBQVEsRUFBRSxXQUFXLENBQUMsUUFBUTtvQkFDOUIsaUJBQWlCLEVBQUUsV0FBVyxDQUFDLFlBQVk7b0JBQzNDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxnQkFBZ0I7b0JBQzlDLE1BQU0sRUFBRSxXQUFXLENBQUMsTUFBTTtpQkFDM0IsQ0FDRixDQUFDO2dCQUNGLE1BQU0sQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7YUFDM0U7WUFDRCxJQUFJLFFBQVEsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3JCLE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSx5QkFBTyxDQUFDLGdDQUFnQyxDQUM1RCxJQUFJLEVBQ0osYUFBYSxFQUNiO29CQUNFLFFBQVE7b0JBQ1IsR0FBRyxRQUFRLENBQUMsUUFBUTtpQkFDckIsQ0FDRixDQUFDO2dCQUNGLE1BQU0sQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDO29CQUM5QyxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQzthQUM5QjtZQUNELElBQUksUUFBUSxDQUFDLGVBQWUsRUFBRTtnQkFDNUIsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLHlCQUFPLENBQUMsOEJBQThCLENBQ3hELElBQUksRUFDSixXQUFXLEVBQ1g7b0JBQ0UsUUFBUTtvQkFDUixHQUFHLFFBQVEsQ0FBQyxlQUFlO2lCQUM1QixDQUNGLENBQUM7Z0JBQ0YsTUFBTSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUM7b0JBQzVDLFFBQVEsQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDO2FBQ3JDO1lBQ0QsSUFBSSxRQUFRLENBQUMsZUFBZSxFQUFFO2dCQUM1QixNQUFNLENBQUMsS0FBSyxHQUFHLElBQUkseUJBQU8sQ0FBQyw2QkFBNkIsQ0FDdEQsSUFBSSxFQUNKLFVBQVUsRUFDVjtvQkFDRSxRQUFRO29CQUNSLEdBQUcsUUFBUSxDQUFDLGVBQWU7aUJBQzVCLENBQ0YsQ0FBQztnQkFDRixNQUFNLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQztvQkFDM0MsUUFBUSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUM7YUFDckM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxJQUFJLEVBQUU7Z0JBQ2pCLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSx5QkFBTyxDQUFDLDRCQUE0QixDQUFDLElBQUksRUFBRSxTQUFTLEVBQUU7b0JBQ3RFLFFBQVE7b0JBQ1IsR0FBRyxRQUFRLENBQUMsSUFBSTtpQkFDakIsQ0FBQyxDQUFDO2FBQ0o7WUFDRCxJQUFJLFFBQVEsQ0FBQyxJQUFJLEVBQUU7Z0JBQ2pCLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSx5QkFBTyxDQUFDLDRCQUE0QixDQUFDLElBQUksRUFBRSxTQUFTLEVBQUU7b0JBQ3RFLFFBQVE7b0JBQ1IsR0FBRyxRQUFRLENBQUMsSUFBSTtpQkFDakIsQ0FBQyxDQUFDO2FBQ0o7WUFDRCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDLENBQUM7UUFFRjs7OztXQUlHO1FBQ0ssbUJBQWMsR0FBRyxDQUN2QixNQUF5QyxFQUNuQixFQUFFO1lBQ3hCLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtnQkFDeEIsT0FBTyxFQUFFLENBQUM7YUFDWDtZQUNELE1BQU0sTUFBTSxHQUF5QixFQUFFLENBQUM7WUFDeEMsS0FBSyxNQUFNLEtBQUssSUFBSSxNQUFNLEVBQUU7Z0JBQzFCLE1BQU0sQ0FBQyxJQUFJLENBQUMseUJBQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzthQUN4QztZQUNELE9BQU8sTUFBTSxDQUFDO1FBQ2hCLENBQUMsQ0FBQztRQUVGOztXQUVHO1FBQ0ssZ0JBQVcsR0FBRyxDQUNwQix3QkFBa0UsSUFBSSxrRUFBeUMsQ0FDN0csbUJBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQ2YsRUFDSyxFQUFFOztZQUNSLE1BQU0sTUFBTSxHQUEwQjtnQkFDcEMsVUFBVSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFVBQVU7Z0JBQzlDLFdBQVcsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0I7Z0JBQzNELGNBQWMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsR0FBRztnQkFDL0QsVUFBVSxFQUFFLG1CQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU07YUFDbEMsQ0FBQztZQUVGLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGtCQUFrQixFQUFFO2dCQUNqRCxNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQ3JDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxrQkFBa0IsQ0FDOUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFhLEVBQUUsQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLEVBQUUsRUFBRTtvQkFDckQsSUFBSSxTQUFTLGFBQVQsU0FBUyx1QkFBVCxTQUFTLENBQUUsUUFBUSxFQUFFO3dCQUN2QixNQUFNLG9CQUFvQixHQUFHLHFDQUFvQixDQUFDLElBQUksQ0FDcEQsQ0FBQyxFQUFFLHFCQUFxQixFQUFFLEVBQUUsRUFBRSxDQUM1QixxQkFBcUIsS0FBSyxhQUFhLENBQzFDLENBQUM7d0JBRUYsSUFBSSxvQkFBb0IsRUFBRTs0QkFDeEIsT0FBTztnQ0FDTCxHQUFHLEdBQUc7Z0NBQ04sb0JBQW9CLENBQUMscUJBQXFCLENBQUMsV0FBVyxFQUFFOzZCQUN6RCxDQUFDO3lCQUNIO3FCQUNGO29CQUNELE9BQU8sR0FBRyxDQUFDO2dCQUNiLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDUCxNQUFNLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2FBQzVEO1lBRUQsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsYUFBYSxFQUFFO2dCQUM1QyxNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztnQkFDOUIsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRTtvQkFDbEQsa0JBQWtCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2lCQUNsQztnQkFDRCxJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFO29CQUNsRCxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7aUJBQ3pDO2dCQUNELElBQ0UsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQyxpQkFBaUI7b0JBQzFELElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUNqRDtvQkFDQSxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztpQkFDL0M7Z0JBQ0QsSUFBSSxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUNqQyxNQUFNLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO2lCQUNoRTthQUNGO1lBRUQsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsVUFBVSxFQUFFO2dCQUN6QyxNQUFNLHNCQUFzQixHQUFHLEVBQUUsQ0FBQztnQkFDbEMsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRTtvQkFDL0Msc0JBQXNCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2lCQUN0QztnQkFDRCxJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFO29CQUMvQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQ3RDO2dCQUNELElBQUksc0JBQXNCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQkFDckMsTUFBTSxDQUFDLHNCQUFzQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsQ0FBQztpQkFDeEU7YUFDRjtZQUVELElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGNBQWMsRUFBRTtnQkFDN0MsTUFBTSxDQUFDLHVCQUF1QjtvQkFDNUIsTUFBQSxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLFNBQVMsMENBQUUsUUFBUSxFQUFFLENBQUM7Z0JBRWxFLE1BQU0sWUFBWSxHQUFHLEVBQUUsQ0FBQztnQkFDeEIsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRTtvQkFDM0QsWUFBWSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO2lCQUN2QztnQkFDRCxJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLEVBQUU7b0JBQzlELFlBQVksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztpQkFDekM7Z0JBQ0QsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLGdCQUFnQixFQUFFO29CQUM5RCxZQUFZLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7aUJBQ3pDO2dCQUNELElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGNBQWMsQ0FBQyxjQUFjLEVBQUU7b0JBQzVELFlBQVksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztpQkFDdkM7Z0JBRUQsSUFBSSxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQkFDM0IsTUFBTSxDQUFDLDBCQUEwQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7aUJBQ2xFO2FBQ0Y7WUFFRCxJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2xDLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsR0FBRyxDQUFDO2dCQUV6RCxNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUM7Z0JBQ3BCLElBQUksTUFBQSxJQUFJLENBQUMscUJBQXFCLENBQUMsZUFBZSwwQ0FBRSxHQUFHLEVBQUU7b0JBQ25ELFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7aUJBQ3ZCO2dCQUNELElBQUksTUFBQSxJQUFJLENBQUMscUJBQXFCLENBQUMsZUFBZSwwQ0FBRSxHQUFHLEVBQUU7b0JBQ25ELFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ3RCO2dCQUNELElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ3ZCLE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztpQkFDNUM7YUFDRjtZQUVELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDaEQsTUFBTSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ3RFO1lBQ0QsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNsRCxNQUFNLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUMxRTtZQUNELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDaEQsTUFBTSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ3RFO1lBQ0QsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUMvQyxNQUFNLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDcEU7WUFFRCxxQkFBcUIsQ0FBQyxxQkFBcUIsQ0FBQyxzQ0FBYSxFQUFFO2dCQUN6RCxPQUFPLEVBQUUsR0FBRztnQkFDWixPQUFPLEVBQUUsTUFBTTthQUNoQixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUM7UUFFRjs7OztXQUlHO1FBQ0gsZUFBVSxHQUFHLENBQ1gsS0FBbUIsRUFDbkIsT0FBb0MsRUFDOUIsRUFBRTtZQUNSLElBQUksV0FBVyxJQUFJLE9BQU8sRUFBRTtnQkFDMUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQ3RCLCtCQUFpQixDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFDM0IsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQ3pCLENBQUM7YUFDSDtpQkFBTTtnQkFDTCwwQkFBMEI7Z0JBQzFCLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLCtCQUFpQixDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQzthQUNoRTtRQUNILENBQUMsQ0FBQztRQTNvQkEsV0FBVztRQUNYLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLHlCQUFPLENBQUMsUUFBUSxDQUNsQyxJQUFJLEVBQ0osVUFBVSxFQUNWLElBQUksQ0FBQyxxQkFBcUIsQ0FDM0IsQ0FBQztRQUVGLGdDQUFnQztRQUNoQyxNQUFNLG1CQUFtQixHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FDckQsSUFBSSxDQUFDLFFBQVEsRUFDYixLQUFLLENBQUMsU0FBUyxDQUNoQixDQUFDO1FBQ0YsSUFBSSxDQUFDLGFBQWEsR0FBRyxtQkFBbUIsQ0FBQyxhQUFhLENBQUM7UUFFdkQsa0JBQWtCO1FBQ2xCLE1BQU0saUJBQWlCLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQztRQUM1RCxNQUFNLGNBQWMsR0FBRyxJQUFJLHlCQUFPLENBQUMsY0FBYyxDQUMvQyxJQUFJLEVBQ0osbUJBQW1CLEVBQ25CO1lBQ0UsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO1lBQ3ZCLFNBQVMsRUFBRSxzQkFBUSxDQUFDLFVBQVU7WUFDOUIsMEJBQTBCLEVBQUUsc0JBQVEsQ0FBQyw2QkFBNkI7WUFDbEUsS0FBSyxFQUFFO2dCQUNMLEdBQUcsQ0FBQyxDQUFBLGlCQUFpQixhQUFqQixpQkFBaUIsdUJBQWpCLGlCQUFpQixDQUFFLFlBQVk7b0JBQ2pDLENBQUMsQ0FBQyxFQUFFLFlBQVksRUFBRSxpQkFBaUIsQ0FBQyxZQUFZLEVBQUU7b0JBQ2xELENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ1AsR0FBRyxDQUFDLENBQUEsaUJBQWlCLGFBQWpCLGlCQUFpQix1QkFBakIsaUJBQWlCLENBQUUsVUFBVTtvQkFDL0IsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLGlCQUFpQixDQUFDLFVBQVUsRUFBRTtvQkFDOUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztnQkFDUCxHQUFHLENBQUMsQ0FBQSxpQkFBaUIsYUFBakIsaUJBQWlCLHVCQUFqQixpQkFBaUIsQ0FBRSxNQUFNO29CQUMzQixDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDM0QsQ0FBQyxDQUFDLEVBQUUsQ0FBQzthQUNSO1NBQ0YsQ0FDRixDQUFDO1FBRUYsZ0JBQWdCO1FBQ2hCLE1BQU0sRUFDSixZQUFZLEVBQ1osMEJBQTBCLEVBQzFCLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsR0FDeEIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQ3hCLElBQUksQ0FBQyxRQUFRLEVBQ2IsY0FBYyxFQUNkLG1CQUFtQixDQUNwQixDQUFDO1FBRUYsbUJBQW1CO1FBQ25CLElBQUksQ0FBQyxTQUFTLEdBQUc7WUFDZixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDdkIsY0FBYztZQUNkLHdCQUF3QixFQUFFLElBQUk7WUFDOUIsMEJBQTBCLEVBQUUsTUFBTTtZQUNsQyxZQUFZLEVBQUU7Z0JBQ1osV0FBVyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQWdCO2dCQUNwRSxpQkFBaUIsRUFBRSxjQUFjLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FDOUMsVUFBVSxDQUNVO2dCQUN0QixlQUFlLEVBQUUsWUFBWTtnQkFDN0IsNkJBQTZCLEVBQUUsMEJBQTBCO2FBQzFEO1NBQ0YsQ0FBQztRQUNGLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFFOUMsSUFBSSxtREFBMEIsRUFBRSxDQUFDLHdCQUF3QixDQUN2RCxtQkFBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFDZCxhQUFhLEVBQ2IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUM5QyxDQUFDO0lBQ0osQ0FBQztJQW9NRDs7Ozs7T0FLRztJQUNLLGVBQWUsQ0FDckIsYUFBaUM7UUFFakMsSUFBSSxTQUE2QixDQUFDO1FBQ2xDLElBQ0UsYUFBYSxDQUFDLHFCQUFxQjtZQUNuQyxhQUFhLENBQUMsc0JBQXNCLEtBQUssTUFBTSxFQUMvQztZQUNBLFNBQVMsR0FBRyxhQUFhLENBQUMscUJBQXFCLENBQzdDLCtCQUErQixDQUFDLElBQUksQ0FDckMsQ0FBQztZQUNGLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLCtCQUErQixDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUM3RCxNQUFNLEtBQUssQ0FDVCxzSkFBc0osQ0FDdkosQ0FBQzthQUNIO1NBQ0Y7UUFDRCxJQUNFLGFBQWEsQ0FBQyxxQkFBcUI7WUFDbkMsYUFBYSxDQUFDLHNCQUFzQixLQUFLLE1BQU0sRUFDL0M7WUFDQSxTQUFTLEdBQUcsYUFBYSxDQUFDLHFCQUFxQixDQUM3QywrQkFBK0IsQ0FBQyxJQUFJLENBQ3JDLENBQUM7WUFDRixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQywrQkFBK0IsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDN0QsTUFBTSxLQUFLLENBQ1Qsc0pBQXNKLENBQ3ZKLENBQUM7YUFDSDtTQUNGO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztDQTRWRjtBQXhxQkQsa0NBd3FCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgUmVtb3ZhbFBvbGljeSwgU3RhY2ssIGF3c19jb2duaXRvIGFzIGNvZ25pdG8gfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQge1xuICBBbXBsaWZ5RnVuY3Rpb24sXG4gIEF1dGhSZXNvdXJjZXMsXG4gIEJhY2tlbmRPdXRwdXRTdG9yYWdlU3RyYXRlZ3ksXG4gIFJlc291cmNlUHJvdmlkZXIsXG59IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbHVnaW4tdHlwZXMnO1xuaW1wb3J0IHtcbiAgQ2ZuVXNlclBvb2wsXG4gIENmblVzZXJQb29sQ2xpZW50LFxuICBNZmEsXG4gIFVzZXJQb29sLFxuICBVc2VyUG9vbENsaWVudCxcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyQW1hem9uLFxuICBVc2VyUG9vbElkZW50aXR5UHJvdmlkZXJBcHBsZSxcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyRmFjZWJvb2ssXG4gIFVzZXJQb29sSWRlbnRpdHlQcm92aWRlckdvb2dsZSxcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyT2lkYyxcbiAgVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyU2FtbCxcbiAgVXNlclBvb2xPcGVyYXRpb24sXG4gIFVzZXJQb29sUHJvcHMsXG59IGZyb20gJ2F3cy1jZGstbGliL2F3cy1jb2duaXRvJztcbmltcG9ydCB7IEZlZGVyYXRlZFByaW5jaXBhbCwgUm9sZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgQXV0aE91dHB1dCwgYXV0aE91dHB1dEtleSB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9iYWNrZW5kLW91dHB1dC1zY2hlbWFzJztcbmltcG9ydCB7XG4gIEF1dGhQcm9wcyxcbiAgRW1haWxMb2dpblNldHRpbmdzLFxuICBFeHRlcm5hbFByb3ZpZGVyT3B0aW9ucyxcbiAgVHJpZ2dlckV2ZW50LFxufSBmcm9tICcuL3R5cGVzLmpzJztcbmltcG9ydCB7IERFRkFVTFRTIH0gZnJvbSAnLi9kZWZhdWx0cy5qcyc7XG5pbXBvcnQgeyBJRnVuY3Rpb24gfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbGFtYmRhJztcbmltcG9ydCB7XG4gIEF0dHJpYnV0aW9uTWV0YWRhdGFTdG9yYWdlLFxuICBTdGFja01ldGFkYXRhQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneSxcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L2JhY2tlbmQtb3V0cHV0LXN0b3JhZ2UnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGNvcmVBdHRyaWJ1dGVOYW1lTWFwIH0gZnJvbSAnLi9zdHJpbmdfbWFwcy5qcyc7XG5cbnR5cGUgRGVmYXVsdFJvbGVzID0geyBhdXRoOiBSb2xlOyB1bkF1dGg6IFJvbGUgfTtcbnR5cGUgSWRlbnRpdHlQcm92aWRlclNldHVwUmVzdWx0ID0ge1xuICBvYXV0aE1hcHBpbmdzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICBnb29nbGU/OiBVc2VyUG9vbElkZW50aXR5UHJvdmlkZXJHb29nbGU7XG4gIGZhY2Vib29rPzogVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyRmFjZWJvb2s7XG4gIGFtYXpvbj86IFVzZXJQb29sSWRlbnRpdHlQcm92aWRlckFtYXpvbjtcbiAgYXBwbGU/OiBVc2VyUG9vbElkZW50aXR5UHJvdmlkZXJBcHBsZTtcbiAgb2lkYz86IFVzZXJQb29sSWRlbnRpdHlQcm92aWRlck9pZGM7XG4gIHNhbWw/OiBVc2VyUG9vbElkZW50aXR5UHJvdmlkZXJTYW1sO1xufTtcbmNvbnN0IGF1dGhQcm92aWRlcnNMaXN0ID0ge1xuICBmYWNlYm9vazogJ2dyYXBoLmZhY2Vib29rLmNvbScsXG4gIGdvb2dsZTogJ2FjY291bnRzLmdvb2dsZS5jb20nLFxuICBhbWF6b246ICd3d3cuYW1hem9uLmNvbScsXG4gIGFwcGxlOiAnYXBwbGVpZC5hcHBsZS5jb20nLFxufTtcbmNvbnN0IFZFUklGSUNBVElPTl9FTUFJTF9QTEFDRUhPTERFUlMgPSB7XG4gIENPREU6ICd7IyMjI30nLFxuICBMSU5LOiAneyMjVmVyaWZ5IEVtYWlsIyN9Jyxcbn07XG5jb25zdCBWRVJJRklDQVRJT05fU01TX1BMQUNFSE9MREVSUyA9IHtcbiAgQ09ERTogJ3sjIyMjfScsXG59O1xuY29uc3QgTUZBX1NNU19QTEFDRUhPTERFUlMgPSB7XG4gIENPREU6ICd7IyMjI30nLFxufTtcblxuLy8gQmUgdmVyeSBjYXJlZnVsIGVkaXRpbmcgdGhpcyB2YWx1ZS4gSXQgaXMgdGhlIHN0cmluZyB0aGF0IGlzIHVzZWQgdG8gYXR0cmlidXRlIHN0YWNrcyB0byBBbXBsaWZ5IEF1dGggaW4gQkkgbWV0cmljc1xuY29uc3QgYXV0aFN0YWNrVHlwZSA9ICdhdXRoLUNvZ25pdG8nO1xuXG4vKipcbiAqIEFtcGxpZnkgQXV0aCBDREsgQ29uc3RydWN0XG4gKi9cbmV4cG9ydCBjbGFzcyBBbXBsaWZ5QXV0aFxuICBleHRlbmRzIENvbnN0cnVjdFxuICBpbXBsZW1lbnRzIFJlc291cmNlUHJvdmlkZXI8QXV0aFJlc291cmNlcz5cbntcbiAgLyoqXG4gICAqIFRoZSByZXNvdXJjZXMgZ2VuZXJhdGVkIGJ5IHRoZSBjb25zdHJ1Y3QuXG4gICAqL1xuICByZWFkb25seSByZXNvdXJjZXM6IEF1dGhSZXNvdXJjZXM7XG4gIC8qKlxuICAgKiBNYXAgZnJvbSBvYXV0aCBwcm92aWRlciB0byBjbGllbnQgaWRcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgb2F1dGhNYXBwaW5nczogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcblxuICBwcml2YXRlIHJlYWRvbmx5IHVzZXJQb29sOiBVc2VyUG9vbDtcblxuICBwcml2YXRlIHJlYWRvbmx5IGNvbXB1dGVkVXNlclBvb2xQcm9wczogVXNlclBvb2xQcm9wcztcblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IEF1dGggY29uc3RydWN0IHdpdGggQXV0aFByb3BzLlxuICAgKiBJZiBubyBwcm9wcyBhcmUgcHJvdmlkZWQsIGVtYWlsIGxvZ2luIGFuZCBkZWZhdWx0cyB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcHJvcHM6IEF1dGhQcm9wcyA9IERFRkFVTFRTLklGX05PX1BST1BTX1BST1ZJREVEXG4gICkge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICAvLyBVc2VyUG9vbFxuICAgIHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzID0gdGhpcy5nZXRVc2VyUG9vbFByb3BzKHByb3BzKTtcbiAgICB0aGlzLnVzZXJQb29sID0gbmV3IGNvZ25pdG8uVXNlclBvb2woXG4gICAgICB0aGlzLFxuICAgICAgJ1VzZXJQb29sJyxcbiAgICAgIHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzXG4gICAgKTtcblxuICAgIC8vIFVzZXJQb29sIC0gSWRlbnRpdHkgUHJvdmlkZXJzXG4gICAgY29uc3QgcHJvdmlkZXJTZXR1cFJlc3VsdCA9IHRoaXMuc2V0dXBJZGVudGl0eVByb3ZpZGVycyhcbiAgICAgIHRoaXMudXNlclBvb2wsXG4gICAgICBwcm9wcy5sb2dpbldpdGhcbiAgICApO1xuICAgIHRoaXMub2F1dGhNYXBwaW5ncyA9IHByb3ZpZGVyU2V0dXBSZXN1bHQub2F1dGhNYXBwaW5ncztcblxuICAgIC8vIFVzZXJQb29sIENsaWVudFxuICAgIGNvbnN0IGV4dGVybmFsUHJvdmlkZXJzID0gcHJvcHMubG9naW5XaXRoLmV4dGVybmFsUHJvdmlkZXJzO1xuICAgIGNvbnN0IHVzZXJQb29sQ2xpZW50ID0gbmV3IGNvZ25pdG8uVXNlclBvb2xDbGllbnQoXG4gICAgICB0aGlzLFxuICAgICAgJ1VzZXJQb29sQXBwQ2xpZW50JyxcbiAgICAgIHtcbiAgICAgICAgdXNlclBvb2w6IHRoaXMudXNlclBvb2wsXG4gICAgICAgIGF1dGhGbG93czogREVGQVVMVFMuQVVUSF9GTE9XUyxcbiAgICAgICAgcHJldmVudFVzZXJFeGlzdGVuY2VFcnJvcnM6IERFRkFVTFRTLlBSRVZFTlRfVVNFUl9FWElTVEVOQ0VfRVJST1JTLFxuICAgICAgICBvQXV0aDoge1xuICAgICAgICAgIC4uLihleHRlcm5hbFByb3ZpZGVycz8uY2FsbGJhY2tVcmxzXG4gICAgICAgICAgICA/IHsgY2FsbGJhY2tVcmxzOiBleHRlcm5hbFByb3ZpZGVycy5jYWxsYmFja1VybHMgfVxuICAgICAgICAgICAgOiB7fSksXG4gICAgICAgICAgLi4uKGV4dGVybmFsUHJvdmlkZXJzPy5sb2dvdXRVcmxzXG4gICAgICAgICAgICA/IHsgbG9nb3V0VXJsczogZXh0ZXJuYWxQcm92aWRlcnMubG9nb3V0VXJscyB9XG4gICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgICAuLi4oZXh0ZXJuYWxQcm92aWRlcnM/LnNjb3Blc1xuICAgICAgICAgICAgPyB7IHNjb3BlczogdGhpcy5nZXRPQXV0aFNjb3BlcyhleHRlcm5hbFByb3ZpZGVycy5zY29wZXMpIH1cbiAgICAgICAgICAgIDoge30pLFxuICAgICAgICB9LFxuICAgICAgfVxuICAgICk7XG5cbiAgICAvLyBJZGVudGl0eSBQb29sXG4gICAgY29uc3Qge1xuICAgICAgaWRlbnRpdHlQb29sLFxuICAgICAgaWRlbnRpdHlQb29sUm9sZUF0dGFjaG1lbnQsXG4gICAgICByb2xlczogeyBhdXRoLCB1bkF1dGggfSxcbiAgICB9ID0gdGhpcy5zZXR1cElkZW50aXR5UG9vbChcbiAgICAgIHRoaXMudXNlclBvb2wsXG4gICAgICB1c2VyUG9vbENsaWVudCxcbiAgICAgIHByb3ZpZGVyU2V0dXBSZXN1bHRcbiAgICApO1xuXG4gICAgLy8gZXhwb3NlIHJlc291cmNlc1xuICAgIHRoaXMucmVzb3VyY2VzID0ge1xuICAgICAgdXNlclBvb2w6IHRoaXMudXNlclBvb2wsXG4gICAgICB1c2VyUG9vbENsaWVudCxcbiAgICAgIGF1dGhlbnRpY2F0ZWRVc2VySWFtUm9sZTogYXV0aCxcbiAgICAgIHVuYXV0aGVudGljYXRlZFVzZXJJYW1Sb2xlOiB1bkF1dGgsXG4gICAgICBjZm5SZXNvdXJjZXM6IHtcbiAgICAgICAgY2ZuVXNlclBvb2w6IHRoaXMudXNlclBvb2wubm9kZS5maW5kQ2hpbGQoJ1Jlc291cmNlJykgYXMgQ2ZuVXNlclBvb2wsXG4gICAgICAgIGNmblVzZXJQb29sQ2xpZW50OiB1c2VyUG9vbENsaWVudC5ub2RlLmZpbmRDaGlsZChcbiAgICAgICAgICAnUmVzb3VyY2UnXG4gICAgICAgICkgYXMgQ2ZuVXNlclBvb2xDbGllbnQsXG4gICAgICAgIGNmbklkZW50aXR5UG9vbDogaWRlbnRpdHlQb29sLFxuICAgICAgICBjZm5JZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudDogaWRlbnRpdHlQb29sUm9sZUF0dGFjaG1lbnQsXG4gICAgICB9LFxuICAgIH07XG4gICAgdGhpcy5zdG9yZU91dHB1dChwcm9wcy5vdXRwdXRTdG9yYWdlU3RyYXRlZ3kpO1xuXG4gICAgbmV3IEF0dHJpYnV0aW9uTWV0YWRhdGFTdG9yYWdlKCkuc3RvcmVBdHRyaWJ1dGlvbk1ldGFkYXRhKFxuICAgICAgU3RhY2sub2YodGhpcyksXG4gICAgICBhdXRoU3RhY2tUeXBlLFxuICAgICAgcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJ3BhY2thZ2UuanNvbicpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgQXV0aC9VbkF1dGggUm9sZXNcbiAgICogQHJldHVybnMgRGVmYXVsdFJvbGVzXG4gICAqL1xuICBwcml2YXRlIHNldHVwQXV0aEFuZFVuQXV0aFJvbGVzID0gKGlkZW50aXR5UG9vbElkOiBzdHJpbmcpOiBEZWZhdWx0Um9sZXMgPT4ge1xuICAgIGNvbnN0IHJlc3VsdDogRGVmYXVsdFJvbGVzID0ge1xuICAgICAgYXV0aDogbmV3IFJvbGUodGhpcywgJ2F1dGhlbnRpY2F0ZWRVc2VyUm9sZScsIHtcbiAgICAgICAgYXNzdW1lZEJ5OiBuZXcgRmVkZXJhdGVkUHJpbmNpcGFsKFxuICAgICAgICAgICdjb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb20nLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIFN0cmluZ0VxdWFsczoge1xuICAgICAgICAgICAgICAnY29nbml0by1pZGVudGl0eS5hbWF6b25hd3MuY29tOmF1ZCc6IGlkZW50aXR5UG9vbElkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdGb3JBbnlWYWx1ZTpTdHJpbmdMaWtlJzoge1xuICAgICAgICAgICAgICAnY29nbml0by1pZGVudGl0eS5hbWF6b25hd3MuY29tOmFtcic6ICdhdXRoZW50aWNhdGVkJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICAnc3RzOkFzc3VtZVJvbGVXaXRoV2ViSWRlbnRpdHknXG4gICAgICAgICksXG4gICAgICB9KSxcbiAgICAgIHVuQXV0aDogbmV3IFJvbGUodGhpcywgJ3VuYXV0aGVudGljYXRlZFVzZXJSb2xlJywge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBGZWRlcmF0ZWRQcmluY2lwYWwoXG4gICAgICAgICAgJ2NvZ25pdG8taWRlbnRpdHkuYW1hem9uYXdzLmNvbScsXG4gICAgICAgICAge1xuICAgICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAgICdjb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb206YXVkJzogaWRlbnRpdHlQb29sSWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ0ZvckFueVZhbHVlOlN0cmluZ0xpa2UnOiB7XG4gICAgICAgICAgICAgICdjb2duaXRvLWlkZW50aXR5LmFtYXpvbmF3cy5jb206YW1yJzogJ3VuYXV0aGVudGljYXRlZCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgJ3N0czpBc3N1bWVSb2xlV2l0aFdlYklkZW50aXR5J1xuICAgICAgICApLFxuICAgICAgfSksXG4gICAgfTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXR1cCBJZGVudGl0eSBQb29sIHdpdGggZGVmYXVsdCByb2xlcy9yb2xlIG1hcHBpbmdzLCBhbmQgcmVnaXN0ZXIgcHJvdmlkZXJzXG4gICAqL1xuICBwcml2YXRlIHNldHVwSWRlbnRpdHlQb29sID0gKFxuICAgIHVzZXJQb29sOiBVc2VyUG9vbCxcbiAgICB1c2VyUG9vbENsaWVudDogVXNlclBvb2xDbGllbnQsXG4gICAgcHJvdmlkZXJTZXR1cFJlc3VsdDogSWRlbnRpdHlQcm92aWRlclNldHVwUmVzdWx0XG4gICkgPT4ge1xuICAgIC8vIHNldHVwIGlkZW50aXR5IHBvb2xcbiAgICBjb25zdCByZWdpb24gPSBTdGFjay5vZih0aGlzKS5yZWdpb247XG4gICAgY29uc3QgaWRlbnRpdHlQb29sID0gbmV3IGNvZ25pdG8uQ2ZuSWRlbnRpdHlQb29sKHRoaXMsICdJZGVudGl0eVBvb2wnLCB7XG4gICAgICBhbGxvd1VuYXV0aGVudGljYXRlZElkZW50aXRpZXM6IERFRkFVTFRTLkFMTE9XX1VOQVVUSEVOVElDQVRFRF9JREVOVElUSUVTLFxuICAgIH0pO1xuICAgIGNvbnN0IHJvbGVzID0gdGhpcy5zZXR1cEF1dGhBbmRVbkF1dGhSb2xlcyhpZGVudGl0eVBvb2wucmVmKTtcbiAgICBjb25zdCBpZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudCA9XG4gICAgICBuZXcgY29nbml0by5DZm5JZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudChcbiAgICAgICAgdGhpcyxcbiAgICAgICAgJ0lkZW50aXR5UG9vbFJvbGVBdHRhY2htZW50JyxcbiAgICAgICAge1xuICAgICAgICAgIGlkZW50aXR5UG9vbElkOiBpZGVudGl0eVBvb2wucmVmLFxuICAgICAgICAgIHJvbGVzOiB7XG4gICAgICAgICAgICB1bmF1dGhlbnRpY2F0ZWQ6IHJvbGVzLnVuQXV0aC5yb2xlQXJuLFxuICAgICAgICAgICAgYXV0aGVudGljYXRlZDogcm9sZXMuYXV0aC5yb2xlQXJuLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcm9sZU1hcHBpbmdzOiB7XG4gICAgICAgICAgICBVc2VyUG9vbFdlYkNsaWVudFJvbGVNYXBwaW5nOiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdUb2tlbicsXG4gICAgICAgICAgICAgIGFtYmlndW91c1JvbGVSZXNvbHV0aW9uOiAnQXV0aGVudGljYXRlZFJvbGUnLFxuICAgICAgICAgICAgICBpZGVudGl0eVByb3ZpZGVyOiBgY29nbml0by1pZHAuJHtyZWdpb259LmFtYXpvbmF3cy5jb20vJHt1c2VyUG9vbC51c2VyUG9vbElkfToke3VzZXJQb29sQ2xpZW50LnVzZXJQb29sQ2xpZW50SWR9YCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICBpZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudC5hZGREZXBlbmRlbmN5KGlkZW50aXR5UG9vbCk7XG4gICAgaWRlbnRpdHlQb29sUm9sZUF0dGFjaG1lbnQubm9kZS5hZGREZXBlbmRlbmN5KHVzZXJQb29sQ2xpZW50KTtcbiAgICAvLyBhZGQgY29nbml0byBwcm92aWRlclxuICAgIGlkZW50aXR5UG9vbC5jb2duaXRvSWRlbnRpdHlQcm92aWRlcnMgPSBbXG4gICAgICB7XG4gICAgICAgIGNsaWVudElkOiB1c2VyUG9vbENsaWVudC51c2VyUG9vbENsaWVudElkLFxuICAgICAgICBwcm92aWRlck5hbWU6IGBjb2duaXRvLWlkcC4ke3JlZ2lvbn0uYW1hem9uYXdzLmNvbS8ke3VzZXJQb29sLnVzZXJQb29sSWR9YCxcbiAgICAgIH0sXG4gICAgXTtcbiAgICAvLyBhZGQgb3RoZXIgcHJvdmlkZXJzXG4gICAgaWRlbnRpdHlQb29sLnN1cHBvcnRlZExvZ2luUHJvdmlkZXJzID0gcHJvdmlkZXJTZXR1cFJlc3VsdC5vYXV0aE1hcHBpbmdzO1xuICAgIGlmIChwcm92aWRlclNldHVwUmVzdWx0Lm9pZGMpIHtcbiAgICAgIGlkZW50aXR5UG9vbC5vcGVuSWRDb25uZWN0UHJvdmlkZXJBcm5zID0gW1xuICAgICAgICBgYXJuOiR7cmVnaW9ufTppYW06OiR7XG4gICAgICAgICAgU3RhY2sub2YodGhpcykuYWNjb3VudFxuICAgICAgICB9Om9pZGMtcHJvdmlkZXIvY29nbml0by1pZHAuJHtyZWdpb259LmFtYXpvbmF3cy5jb20vJHtcbiAgICAgICAgICBwcm92aWRlclNldHVwUmVzdWx0Lm9pZGMucHJvdmlkZXJOYW1lXG4gICAgICAgIH1gLFxuICAgICAgXTtcbiAgICB9XG4gICAgaWYgKHByb3ZpZGVyU2V0dXBSZXN1bHQuc2FtbCkge1xuICAgICAgaWRlbnRpdHlQb29sLnNhbWxQcm92aWRlckFybnMgPSBbXG4gICAgICAgIGBhcm46JHtyZWdpb259OmlhbTo6JHtTdGFjay5vZih0aGlzKS5hY2NvdW50fTpzYW1sLXByb3ZpZGVyLyR7XG4gICAgICAgICAgcHJvdmlkZXJTZXR1cFJlc3VsdC5zYW1sLnByb3ZpZGVyTmFtZVxuICAgICAgICB9YCxcbiAgICAgIF07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBpZGVudGl0eVBvb2wsXG4gICAgICBpZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudCxcbiAgICAgIHJvbGVzLFxuICAgIH07XG4gIH07XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgcHJvcHMgaW50byBVc2VyUG9vbFByb3BzIChzZXQgZGVmYXVsdHMgaWYgbmVlZGVkKVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRVc2VyUG9vbFByb3BzID0gKHByb3BzOiBBdXRoUHJvcHMpOiBVc2VyUG9vbFByb3BzID0+IHtcbiAgICBjb25zdCBlbWFpbEVuYWJsZWQgPSBwcm9wcy5sb2dpbldpdGguZW1haWwgPyB0cnVlIDogZmFsc2U7XG4gICAgY29uc3QgcGhvbmVFbmFibGVkID0gcHJvcHMubG9naW5XaXRoLnBob25lID8gdHJ1ZSA6IGZhbHNlO1xuICAgIGNvbnN0IG9uZU9mRW1haWxPclBob25lID0gZW1haWxFbmFibGVkIHx8IHBob25lRW5hYmxlZDtcbiAgICBpZiAoIW9uZU9mRW1haWxPclBob25lKSB7XG4gICAgICB0aHJvdyBFcnJvcignQXQgbGVhc3Qgb25lIG9mIGVtYWlsIG9yIHBob25lIG11c3QgYmUgZW5hYmxlZC4nKTtcbiAgICB9XG4gICAgbGV0IHVzZXJWZXJpZmljYXRpb25TZXR0aW5nczogY29nbml0by5Vc2VyVmVyaWZpY2F0aW9uQ29uZmlnID0ge307XG4gICAgLy8gZXh0cmFjdCBlbWFpbCBzZXR0aW5ncyBpZiBzZXR0aW5ncyBvYmplY3QgaXMgZGVmaW5lZFxuICAgIGlmICh0eXBlb2YgcHJvcHMubG9naW5XaXRoLmVtYWlsID09PSAnb2JqZWN0Jykge1xuICAgICAgY29uc3QgZW1haWxTZXR0aW5ncyA9IHByb3BzLmxvZ2luV2l0aC5lbWFpbDtcbiAgICAgIC8vIHZlcmlmeSBlbWFpbCBib2R5IGFuZCBpbmplY3QgdGhlIGFjdHVhbCB0ZW1wbGF0ZSB2YWx1ZXMgd2hpY2ggY29nbml0byB1c2VzXG4gICAgICBjb25zdCBlbWFpbEJvZHk6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMudmVyaWZ5RW1haWxCb2R5KGVtYWlsU2V0dGluZ3MpO1xuICAgICAgdXNlclZlcmlmaWNhdGlvblNldHRpbmdzID0ge1xuICAgICAgICBlbWFpbEJvZHk6IGVtYWlsQm9keSxcbiAgICAgICAgZW1haWxTdHlsZTogdGhpcy5nZXRFbWFpbFZlcmlmaWNhdGlvblN0eWxlKFxuICAgICAgICAgIGVtYWlsU2V0dGluZ3MudmVyaWZpY2F0aW9uRW1haWxTdHlsZVxuICAgICAgICApLFxuICAgICAgICBlbWFpbFN1YmplY3Q6IGVtYWlsU2V0dGluZ3MudmVyaWZpY2F0aW9uRW1haWxTdWJqZWN0LFxuICAgICAgfTtcbiAgICB9XG4gICAgLy8gZXh0cmFjdCBwaG9uZSBzZXR0aW5ncyBpZiBzZXR0aW5ncyBvYmplY3QgaXMgZGVmaW5lZFxuICAgIGlmICh0eXBlb2YgcHJvcHMubG9naW5XaXRoLnBob25lID09PSAnb2JqZWN0Jykge1xuICAgICAgY29uc3QgcGhvbmVTZXR0aW5ncyA9IHByb3BzLmxvZ2luV2l0aC5waG9uZTtcbiAgICAgIGxldCBzbXNNZXNzYWdlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICBpZiAoXG4gICAgICAgIHBob25lU2V0dGluZ3MudmVyaWZpY2F0aW9uTWVzc2FnZSAmJlxuICAgICAgICB0eXBlb2YgcGhvbmVTZXR0aW5ncy52ZXJpZmljYXRpb25NZXNzYWdlID09PSAnZnVuY3Rpb24nXG4gICAgICApIHtcbiAgICAgICAgLy8gdmFsaWRhdGUgc21zIG1lc3NhZ2Ugc3RydWN0dXJlXG4gICAgICAgIHNtc01lc3NhZ2UgPSBwaG9uZVNldHRpbmdzLnZlcmlmaWNhdGlvbk1lc3NhZ2UoXG4gICAgICAgICAgVkVSSUZJQ0FUSU9OX1NNU19QTEFDRUhPTERFUlMuQ09ERVxuICAgICAgICApO1xuICAgICAgICBpZiAoIXNtc01lc3NhZ2UuaW5jbHVkZXMoVkVSSUZJQ0FUSU9OX1NNU19QTEFDRUhPTERFUlMuQ09ERSkpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAgIFwiSW52YWxpZCBwaG9uZSBzZXR0aW5ncy4gUHJvcGVydHkgJ3ZlcmlmaWNhdGlvbk1lc3NhZ2UnIG11c3QgdXRpbGl6ZSB0aGUgJ2NvZGUnIHBhcmFtZXRlciBhdCBsZWFzdCBvbmNlIGFzIGEgcGxhY2Vob2xkZXIgZm9yIHRoZSB2ZXJpZmljYXRpb24gY29kZS5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHVzZXJWZXJpZmljYXRpb25TZXR0aW5ncyA9IHtcbiAgICAgICAgLi4udXNlclZlcmlmaWNhdGlvblNldHRpbmdzLFxuICAgICAgICBzbXNNZXNzYWdlOiBzbXNNZXNzYWdlLFxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgdXNlclBvb2xQcm9wczogVXNlclBvb2xQcm9wcyA9IHtcbiAgICAgIHNpZ25JbkNhc2VTZW5zaXRpdmU6IERFRkFVTFRTLlNJR05fSU5fQ0FTRV9TRU5TSVRJVkUsXG4gICAgICBzaWduSW5BbGlhc2VzOiB7XG4gICAgICAgIHBob25lOiBwaG9uZUVuYWJsZWQsXG4gICAgICAgIGVtYWlsOiBlbWFpbEVuYWJsZWQsXG4gICAgICB9LFxuICAgICAga2VlcE9yaWdpbmFsOiB7XG4gICAgICAgIGVtYWlsOiBlbWFpbEVuYWJsZWQsXG4gICAgICAgIHBob25lOiBwaG9uZUVuYWJsZWQsXG4gICAgICB9LFxuICAgICAgYXV0b1ZlcmlmeToge1xuICAgICAgICBlbWFpbDogZW1haWxFbmFibGVkLFxuICAgICAgICBwaG9uZTogcGhvbmVFbmFibGVkLFxuICAgICAgfSxcbiAgICAgIHVzZXJWZXJpZmljYXRpb246IHVzZXJWZXJpZmljYXRpb25TZXR0aW5ncyxcbiAgICAgIHBhc3N3b3JkUG9saWN5OiBERUZBVUxUUy5QQVNTV09SRF9QT0xJQ1ksXG4gICAgICBzdGFuZGFyZEF0dHJpYnV0ZXM6IHtcbiAgICAgICAgZW1haWw6IERFRkFVTFRTLklTX1JFUVVJUkVEX0FUVFJJQlVURS5lbWFpbChlbWFpbEVuYWJsZWQpLFxuICAgICAgICBwaG9uZU51bWJlcjogREVGQVVMVFMuSVNfUkVRVUlSRURfQVRUUklCVVRFLnBob25lTnVtYmVyKHBob25lRW5hYmxlZCksXG4gICAgICAgIC4uLihwcm9wcy51c2VyQXR0cmlidXRlcyA/IHByb3BzLnVzZXJBdHRyaWJ1dGVzIDoge30pLFxuICAgICAgfSxcbiAgICAgIHNlbGZTaWduVXBFbmFibGVkOiBERUZBVUxUUy5BTExPV19TRUxGX1NJR05fVVAsXG4gICAgICBtZmE6IHRoaXMuZ2V0TUZBTW9kZShwcm9wcy5tdWx0aWZhY3RvciksXG4gICAgICBtZmFNZXNzYWdlOiB0aGlzLmdldE1GQU1lc3NhZ2UocHJvcHMubXVsdGlmYWN0b3IpLFxuICAgICAgbWZhU2Vjb25kRmFjdG9yOlxuICAgICAgICB0eXBlb2YgcHJvcHMubXVsdGlmYWN0b3IgPT09ICdvYmplY3QnICYmXG4gICAgICAgIHByb3BzLm11bHRpZmFjdG9yLm1vZGUgIT09ICdPRkYnXG4gICAgICAgICAgPyB7XG4gICAgICAgICAgICAgIHNtczogcHJvcHMubXVsdGlmYWN0b3Iuc21zID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgICBvdHA6IHByb3BzLm11bHRpZmFjdG9yLnRvdHAgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICBhY2NvdW50UmVjb3Zlcnk6IHRoaXMuZ2V0QWNjb3VudFJlY292ZXJ5U2V0dGluZyhcbiAgICAgICAgZW1haWxFbmFibGVkLFxuICAgICAgICBwaG9uZUVuYWJsZWQsXG4gICAgICAgIHByb3BzLmFjY291bnRSZWNvdmVyeVxuICAgICAgKSxcbiAgICAgIHJlbW92YWxQb2xpY3k6IFJlbW92YWxQb2xpY3kuREVTVFJPWSxcbiAgICB9O1xuICAgIHJldHVybiB1c2VyUG9vbFByb3BzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBWZXJpZnkgdGhlIGVtYWlsIGJvZHkgZGVwZW5kaW5nIG9uIGlmICdDT0RFJyBvciAnTElOSycgc3R5bGUgaXMgdXNlZC5cbiAgICogVGhpcyBlbnN1cmVzIHRoYXQgdGhlIHRlbXBsYXRlIGNvbnRhaW5zIHRoZSBuZWNlc3NhcnkgcGxhY2Vob2xkZXJzIGZvciBDb2duaXRvIHRvIGluc2VydCB2ZXJpZmljYXRpb24gY29kZXMgb3IgbGlua3MuXG4gICAqIEBwYXJhbSBlbWFpbFNldHRpbmdzIHRoZSBwcm92aWRlZCBlbWFpbCBzZXR0aW5nc1xuICAgKiBAcmV0dXJucyBlbWFpbEJvZHlcbiAgICovXG4gIHByaXZhdGUgdmVyaWZ5RW1haWxCb2R5KFxuICAgIGVtYWlsU2V0dGluZ3M6IEVtYWlsTG9naW5TZXR0aW5nc1xuICApOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGxldCBlbWFpbEJvZHk6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBpZiAoXG4gICAgICBlbWFpbFNldHRpbmdzLnZlcmlmaWNhdGlvbkVtYWlsQm9keSAmJlxuICAgICAgZW1haWxTZXR0aW5ncy52ZXJpZmljYXRpb25FbWFpbFN0eWxlICE9PSAnTElOSydcbiAgICApIHtcbiAgICAgIGVtYWlsQm9keSA9IGVtYWlsU2V0dGluZ3MudmVyaWZpY2F0aW9uRW1haWxCb2R5KFxuICAgICAgICBWRVJJRklDQVRJT05fRU1BSUxfUExBQ0VIT0xERVJTLkNPREVcbiAgICAgICk7XG4gICAgICBpZiAoIWVtYWlsQm9keS5pbmNsdWRlcyhWRVJJRklDQVRJT05fRU1BSUxfUExBQ0VIT0xERVJTLkNPREUpKSB7XG4gICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgIFwiSW52YWxpZCBlbWFpbCBzZXR0aW5ncy4gUHJvcGVydHkgJ3ZlcmlmaWNhdGlvbkVtYWlsQm9keScgbXVzdCB1dGlsaXplIHRoZSAnY29kZScgcGFyYW1ldGVyIGF0IGxlYXN0IG9uY2UgYXMgYSBwbGFjZWhvbGRlciBmb3IgdGhlIHZlcmlmaWNhdGlvbiBjb2RlLlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGVtYWlsU2V0dGluZ3MudmVyaWZpY2F0aW9uRW1haWxCb2R5ICYmXG4gICAgICBlbWFpbFNldHRpbmdzLnZlcmlmaWNhdGlvbkVtYWlsU3R5bGUgPT09ICdMSU5LJ1xuICAgICkge1xuICAgICAgZW1haWxCb2R5ID0gZW1haWxTZXR0aW5ncy52ZXJpZmljYXRpb25FbWFpbEJvZHkoXG4gICAgICAgIFZFUklGSUNBVElPTl9FTUFJTF9QTEFDRUhPTERFUlMuTElOS1xuICAgICAgKTtcbiAgICAgIGlmICghZW1haWxCb2R5LmluY2x1ZGVzKFZFUklGSUNBVElPTl9FTUFJTF9QTEFDRUhPTERFUlMuTElOSykpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJJbnZhbGlkIGVtYWlsIHNldHRpbmdzLiBQcm9wZXJ0eSAndmVyaWZpY2F0aW9uRW1haWxCb2R5JyBtdXN0IHV0aWxpemUgdGhlICdsaW5rJyBwYXJhbWV0ZXIgYXQgbGVhc3Qgb25jZSBhcyBhIHBsYWNlaG9sZGVyIGZvciB0aGUgdmVyaWZpY2F0aW9uIGxpbmsuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVtYWlsQm9keTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZW1haWwgdmVyaWZpY2F0aW9uIHN0eWxlIGZyb20gdXNlciBwcm9wc1xuICAgKiBAcGFyYW0gdmVyaWZpY2F0aW9uRW1haWxTdHlsZSAtIHN0cmluZyB2YWx1ZVxuICAgKiBAcmV0dXJucyB2ZXJpZmljYXRpb25FbWFpbFN0eWxlIC0gZW51bSB2YWx1ZVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRFbWFpbFZlcmlmaWNhdGlvblN0eWxlID0gKFxuICAgIHZlcmlmaWNhdGlvbkVtYWlsU3R5bGU6ICdDT0RFJyB8ICdMSU5LJyB8IHVuZGVmaW5lZFxuICApOiBjb2duaXRvLlZlcmlmaWNhdGlvbkVtYWlsU3R5bGUgfCB1bmRlZmluZWQgPT4ge1xuICAgIGlmICh2ZXJpZmljYXRpb25FbWFpbFN0eWxlID09PSAnQ09ERScpIHtcbiAgICAgIHJldHVybiBjb2duaXRvLlZlcmlmaWNhdGlvbkVtYWlsU3R5bGUuQ09ERTtcbiAgICB9IGVsc2UgaWYgKHZlcmlmaWNhdGlvbkVtYWlsU3R5bGUgPT09ICdMSU5LJykge1xuICAgICAgcmV0dXJuIGNvZ25pdG8uVmVyaWZpY2F0aW9uRW1haWxTdHlsZS5MSU5LO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgdGhlIGFjY291bnQgcmVjb3Zlcnkgb3B0aW9uIGJhc2VkIG9uIGVuYWJsZWQgbG9naW4gbWV0aG9kcy5cbiAgICogQHBhcmFtIGVtYWlsRW5hYmxlZCAtIGlzIGVtYWlsIGVuYWJsZWRcbiAgICogQHBhcmFtIHBob25lRW5hYmxlZCAtIGlzIHBob25lIGVuYWJsZWRcbiAgICogQHBhcmFtIGFjY291bnRSZWNvdmVyeU1ldGhvZEFzU3RyaW5nIC0gdGhlIHVzZXIgcHJvdmlkZWQgYWNjb3VudCByZWNvdmVyeSBzZXR0aW5nXG4gICAqIEByZXR1cm5zIGFjY291bnQgcmVjb3Zlcnkgc2V0dGluZyBlbnVtIHZhbHVlXG4gICAqL1xuICBwcml2YXRlIGdldEFjY291bnRSZWNvdmVyeVNldHRpbmcgPSAoXG4gICAgZW1haWxFbmFibGVkOiBib29sZWFuLFxuICAgIHBob25lRW5hYmxlZDogYm9vbGVhbixcbiAgICBhY2NvdW50UmVjb3ZlcnlNZXRob2RBc1N0cmluZzogQXV0aFByb3BzWydhY2NvdW50UmVjb3ZlcnknXVxuICApOiBjb2duaXRvLkFjY291bnRSZWNvdmVyeSB8IHVuZGVmaW5lZCA9PiB7XG4gICAgY29uc3QgYWNjb3VudFJlY292ZXJ5ID0gdGhpcy5jb252ZXJ0QWNjb3VudFJlY292ZXJ5U3RyaW5nVG9FbnVtKFxuICAgICAgYWNjb3VudFJlY292ZXJ5TWV0aG9kQXNTdHJpbmdcbiAgICApO1xuICAgIGlmIChhY2NvdW50UmVjb3ZlcnkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGFjY291bnRSZWNvdmVyeTtcbiAgICB9XG4gICAgLy8gc2V0IGRlZmF1bHQgYmFzZWQgb24gZW5hYmxlZCBsb2dpbiBtZXRob2RzXG4gICAgaWYgKHBob25lRW5hYmxlZCAmJiBlbWFpbEVuYWJsZWQpIHtcbiAgICAgIHJldHVybiBjb2duaXRvLkFjY291bnRSZWNvdmVyeS5FTUFJTF9PTkxZO1xuICAgIH1cbiAgICBpZiAocGhvbmVFbmFibGVkKSB7XG4gICAgICByZXR1cm4gY29nbml0by5BY2NvdW50UmVjb3ZlcnkuUEhPTkVfT05MWV9XSVRIT1VUX01GQTtcbiAgICB9XG4gICAgaWYgKGVtYWlsRW5hYmxlZCkge1xuICAgICAgcmV0dXJuIGNvZ25pdG8uQWNjb3VudFJlY292ZXJ5LkVNQUlMX09OTFk7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgdXNlciBmcmllbmRseSBNZmEgbW9kZSB0byBjb2duaXRvIE1mYSB0eXBlLlxuICAgKiBUaGlzIGVsaW1pbmF0ZXMgdGhlIG5lZWQgZm9yIHVzZXJzIHRvIGltcG9ydCBjb2duaXRvLk1mYS5cbiAgICogQHBhcmFtIG1mYSAtIE1GQSBzZXR0aW5nc1xuICAgKiBAcmV0dXJucyBjb2duaXRvIE1GQSBlbmZvcmNlbWVudCB0eXBlXG4gICAqL1xuICBwcml2YXRlIGdldE1GQU1vZGUgPSAobWZhOiBBdXRoUHJvcHNbJ211bHRpZmFjdG9yJ10pOiBNZmEgfCB1bmRlZmluZWQgPT4ge1xuICAgIGlmIChtZmEpIHtcbiAgICAgIHN3aXRjaCAobWZhLm1vZGUpIHtcbiAgICAgICAgY2FzZSAnT0ZGJzpcbiAgICAgICAgICByZXR1cm4gTWZhLk9GRjtcbiAgICAgICAgY2FzZSAnT1BUSU9OQUwnOlxuICAgICAgICAgIHJldHVybiBNZmEuT1BUSU9OQUw7XG4gICAgICAgIGNhc2UgJ1JFUVVJUkVEJzpcbiAgICAgICAgICByZXR1cm4gTWZhLlJFUVVJUkVEO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDb252ZXJ0IHVzZXIgZnJpZW5kbHkgYWNjb3VudCByZWNvdmVyeSBtZXRob2QgdG8gY29nbml0byBBY2NvdW50UmVjb3ZlciBlbnVtLlxuICAgKiBUaGlzIGVsaW1pbmF0ZXMgdGhlIG5lZWQgZm9yIHVzZXJzIHRvIGltcG9ydCBjb2duaXRvLkFjY291bnRSZWNvdmVyeS5cbiAgICogQHBhcmFtIG1ldGhvZCAtIGFjY291bnQgcmVjb3ZlcnkgbWV0aG9kIGFzIGEgc3RyaW5nIHZhbHVlXG4gICAqIEByZXR1cm5zIGNvZ25pdG8uQWNjb3VudFJlY292ZXJ5IGVudW0gdmFsdWVcbiAgICovXG4gIHByaXZhdGUgY29udmVydEFjY291bnRSZWNvdmVyeVN0cmluZ1RvRW51bSA9IChcbiAgICBtZXRob2Q6IEF1dGhQcm9wc1snYWNjb3VudFJlY292ZXJ5J11cbiAgKTogY29nbml0by5BY2NvdW50UmVjb3ZlcnkgfCB1bmRlZmluZWQgPT4ge1xuICAgIGlmIChtZXRob2QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGNvZ25pdG8uQWNjb3VudFJlY292ZXJ5W21ldGhvZF07XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgdGhlIE1GQSBtZXNzYWdlIHNldHRpbmdzIGFuZCBwZXJmb3JtIHZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBtZmEgLSBNRkEgc2V0dGluZ3NcbiAgICogQHJldHVybnMgbWZhIG1lc3NhZ2VcbiAgICovXG4gIHByaXZhdGUgZ2V0TUZBTWVzc2FnZSA9IChcbiAgICBtZmE6IEF1dGhQcm9wc1snbXVsdGlmYWN0b3InXVxuICApOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xuICAgIGlmIChtZmEgJiYgbWZhLm1vZGUgIT09ICdPRkYnICYmIHR5cGVvZiBtZmEuc21zID09PSAnb2JqZWN0Jykge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IG1mYS5zbXMuc21zTWVzc2FnZShNRkFfU01TX1BMQUNFSE9MREVSUy5DT0RFKTtcbiAgICAgIGlmICghbWVzc2FnZS5pbmNsdWRlcyhNRkFfU01TX1BMQUNFSE9MREVSUy5DT0RFKSkge1xuICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICBcIkludmFsaWQgTUZBIHNldHRpbmdzLiBQcm9wZXJ0eSAnc21zTWVzc2FnZScgbXVzdCB1dGlsaXplIHRoZSAnY29kZScgcGFyYW1ldGVyIGF0IGxlYXN0IG9uY2UgYXMgYSBwbGFjZWhvbGRlciBmb3IgdGhlIHZlcmlmaWNhdGlvbiBjb2RlLlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICAvKipcbiAgICogU2V0dXAgSWRlbnRpdHkgUHJvdmlkZXJzIChPQXV0aC9PSURDL1NBTUwpXG4gICAqL1xuICBwcml2YXRlIHNldHVwSWRlbnRpdHlQcm92aWRlcnMgPSAoXG4gICAgdXNlclBvb2w6IFVzZXJQb29sLFxuICAgIGxvZ2luT3B0aW9uczogQXV0aFByb3BzWydsb2dpbldpdGgnXVxuICApOiBJZGVudGl0eVByb3ZpZGVyU2V0dXBSZXN1bHQgPT4ge1xuICAgIGNvbnN0IHJlc3VsdDogSWRlbnRpdHlQcm92aWRlclNldHVwUmVzdWx0ID0ge1xuICAgICAgb2F1dGhNYXBwaW5nczoge30sXG4gICAgfTtcbiAgICAvLyBleHRlcm5hbCBwcm92aWRlcnNcbiAgICBjb25zdCBleHRlcm5hbCA9IGxvZ2luT3B0aW9ucy5leHRlcm5hbFByb3ZpZGVycztcbiAgICBpZiAoIWV4dGVybmFsKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBpZiAoZXh0ZXJuYWwuZ29vZ2xlKSB7XG4gICAgICBjb25zdCBnb29nbGVQcm9wcyA9IGV4dGVybmFsLmdvb2dsZTtcbiAgICAgIHJlc3VsdC5nb29nbGUgPSBuZXcgY29nbml0by5Vc2VyUG9vbElkZW50aXR5UHJvdmlkZXJHb29nbGUoXG4gICAgICAgIHRoaXMsXG4gICAgICAgICdHb29nbGVJZFAnLFxuICAgICAgICB7XG4gICAgICAgICAgdXNlclBvb2wsXG4gICAgICAgICAgY2xpZW50SWQ6IGdvb2dsZVByb3BzLmNsaWVudElkLFxuICAgICAgICAgIGNsaWVudFNlY3JldFZhbHVlOiBnb29nbGVQcm9wcy5jbGllbnRTZWNyZXQsXG4gICAgICAgICAgYXR0cmlidXRlTWFwcGluZzogZ29vZ2xlUHJvcHMuYXR0cmlidXRlTWFwcGluZyxcbiAgICAgICAgICBzY29wZXM6IGdvb2dsZVByb3BzLnNjb3BlcyxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlc3VsdC5vYXV0aE1hcHBpbmdzW2F1dGhQcm92aWRlcnNMaXN0Lmdvb2dsZV0gPSBleHRlcm5hbC5nb29nbGUuY2xpZW50SWQ7XG4gICAgfVxuICAgIGlmIChleHRlcm5hbC5mYWNlYm9vaykge1xuICAgICAgcmVzdWx0LmZhY2Vib29rID0gbmV3IGNvZ25pdG8uVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyRmFjZWJvb2soXG4gICAgICAgIHRoaXMsXG4gICAgICAgICdGYWNlYm9va0lEUCcsXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VyUG9vbCxcbiAgICAgICAgICAuLi5leHRlcm5hbC5mYWNlYm9vayxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlc3VsdC5vYXV0aE1hcHBpbmdzW2F1dGhQcm92aWRlcnNMaXN0LmZhY2Vib29rXSA9XG4gICAgICAgIGV4dGVybmFsLmZhY2Vib29rLmNsaWVudElkO1xuICAgIH1cbiAgICBpZiAoZXh0ZXJuYWwubG9naW5XaXRoQW1hem9uKSB7XG4gICAgICByZXN1bHQuYW1hem9uID0gbmV3IGNvZ25pdG8uVXNlclBvb2xJZGVudGl0eVByb3ZpZGVyQW1hem9uKFxuICAgICAgICB0aGlzLFxuICAgICAgICAnQW1hem9uSURQJyxcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJQb29sLFxuICAgICAgICAgIC4uLmV4dGVybmFsLmxvZ2luV2l0aEFtYXpvbixcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlc3VsdC5vYXV0aE1hcHBpbmdzW2F1dGhQcm92aWRlcnNMaXN0LmFtYXpvbl0gPVxuICAgICAgICBleHRlcm5hbC5sb2dpbldpdGhBbWF6b24uY2xpZW50SWQ7XG4gICAgfVxuICAgIGlmIChleHRlcm5hbC5zaWduSW5XaXRoQXBwbGUpIHtcbiAgICAgIHJlc3VsdC5hcHBsZSA9IG5ldyBjb2duaXRvLlVzZXJQb29sSWRlbnRpdHlQcm92aWRlckFwcGxlKFxuICAgICAgICB0aGlzLFxuICAgICAgICAnQXBwbGVJRFAnLFxuICAgICAgICB7XG4gICAgICAgICAgdXNlclBvb2wsXG4gICAgICAgICAgLi4uZXh0ZXJuYWwuc2lnbkluV2l0aEFwcGxlLFxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmVzdWx0Lm9hdXRoTWFwcGluZ3NbYXV0aFByb3ZpZGVyc0xpc3QuYXBwbGVdID1cbiAgICAgICAgZXh0ZXJuYWwuc2lnbkluV2l0aEFwcGxlLmNsaWVudElkO1xuICAgIH1cbiAgICBpZiAoZXh0ZXJuYWwub2lkYykge1xuICAgICAgcmVzdWx0Lm9pZGMgPSBuZXcgY29nbml0by5Vc2VyUG9vbElkZW50aXR5UHJvdmlkZXJPaWRjKHRoaXMsICdPaWRjSURQJywge1xuICAgICAgICB1c2VyUG9vbCxcbiAgICAgICAgLi4uZXh0ZXJuYWwub2lkYyxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoZXh0ZXJuYWwuc2FtbCkge1xuICAgICAgcmVzdWx0LnNhbWwgPSBuZXcgY29nbml0by5Vc2VyUG9vbElkZW50aXR5UHJvdmlkZXJTYW1sKHRoaXMsICdTYW1sSURQJywge1xuICAgICAgICB1c2VyUG9vbCxcbiAgICAgICAgLi4uZXh0ZXJuYWwuc2FtbCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8qKlxuICAgKiBDb252ZXJ0IHNjb3BlcyBmcm9tIHN0cmluZyBsaXN0IHRvIE9BdXRoU2NvcGVzLlxuICAgKiBAcGFyYW0gc2NvcGVzIC0gc2NvcGUgbGlzdFxuICAgKiBAcmV0dXJucyBjb2duaXRvIE9BdXRoU2NvcGVzXG4gICAqL1xuICBwcml2YXRlIGdldE9BdXRoU2NvcGVzID0gKFxuICAgIHNjb3BlczogRXh0ZXJuYWxQcm92aWRlck9wdGlvbnNbJ3Njb3BlcyddXG4gICk6IGNvZ25pdG8uT0F1dGhTY29wZVtdID0+IHtcbiAgICBpZiAoc2NvcGVzID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0OiBjb2duaXRvLk9BdXRoU2NvcGVbXSA9IFtdO1xuICAgIGZvciAoY29uc3Qgc2NvcGUgb2Ygc2NvcGVzKSB7XG4gICAgICByZXN1bHQucHVzaChjb2duaXRvLk9BdXRoU2NvcGVbc2NvcGVdKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKipcbiAgICogU3RvcmVzIGF1dGggb3V0cHV0IHVzaW5nIHRoZSBwcm92aWRlZCBzdHJhdGVneVxuICAgKi9cbiAgcHJpdmF0ZSBzdG9yZU91dHB1dCA9IChcbiAgICBvdXRwdXRTdG9yYWdlU3RyYXRlZ3k6IEJhY2tlbmRPdXRwdXRTdG9yYWdlU3RyYXRlZ3k8QXV0aE91dHB1dD4gPSBuZXcgU3RhY2tNZXRhZGF0YUJhY2tlbmRPdXRwdXRTdG9yYWdlU3RyYXRlZ3koXG4gICAgICBTdGFjay5vZih0aGlzKVxuICAgIClcbiAgKTogdm9pZCA9PiB7XG4gICAgY29uc3Qgb3V0cHV0OiBBdXRoT3V0cHV0WydwYXlsb2FkJ10gPSB7XG4gICAgICB1c2VyUG9vbElkOiB0aGlzLnJlc291cmNlcy51c2VyUG9vbC51c2VyUG9vbElkLFxuICAgICAgd2ViQ2xpZW50SWQ6IHRoaXMucmVzb3VyY2VzLnVzZXJQb29sQ2xpZW50LnVzZXJQb29sQ2xpZW50SWQsXG4gICAgICBpZGVudGl0eVBvb2xJZDogdGhpcy5yZXNvdXJjZXMuY2ZuUmVzb3VyY2VzLmNmbklkZW50aXR5UG9vbC5yZWYsXG4gICAgICBhdXRoUmVnaW9uOiBTdGFjay5vZih0aGlzKS5yZWdpb24sXG4gICAgfTtcblxuICAgIGlmICh0aGlzLmNvbXB1dGVkVXNlclBvb2xQcm9wcy5zdGFuZGFyZEF0dHJpYnV0ZXMpIHtcbiAgICAgIGNvbnN0IHNpZ251cEF0dHJpYnV0ZXMgPSBPYmplY3QuZW50cmllcyhcbiAgICAgICAgdGhpcy5jb21wdXRlZFVzZXJQb29sUHJvcHMuc3RhbmRhcmRBdHRyaWJ1dGVzXG4gICAgICApLnJlZHVjZSgoYWNjOiBzdHJpbmdbXSwgW2F0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZV0pID0+IHtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZT8ucmVxdWlyZWQpIHtcbiAgICAgICAgICBjb25zdCB0cmVhdGVkQXR0cmlidXRlTmFtZSA9IGNvcmVBdHRyaWJ1dGVOYW1lTWFwLmZpbmQoXG4gICAgICAgICAgICAoeyBzdGFuZGFyZEF0dHJpYnV0ZU5hbWUgfSkgPT5cbiAgICAgICAgICAgICAgc3RhbmRhcmRBdHRyaWJ1dGVOYW1lID09PSBhdHRyaWJ1dGVOYW1lXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmICh0cmVhdGVkQXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgLi4uYWNjLFxuICAgICAgICAgICAgICB0cmVhdGVkQXR0cmlidXRlTmFtZS51c2VycG9vbEF0dHJpYnV0ZU5hbWUudG9VcHBlckNhc2UoKSxcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LCBbXSk7XG4gICAgICBvdXRwdXQuc2lnbnVwQXR0cmlidXRlcyA9IEpTT04uc3RyaW5naWZ5KHNpZ251cEF0dHJpYnV0ZXMpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbXB1dGVkVXNlclBvb2xQcm9wcy5zaWduSW5BbGlhc2VzKSB7XG4gICAgICBjb25zdCB1c2VybmFtZUF0dHJpYnV0ZXMgPSBbXTtcbiAgICAgIGlmICh0aGlzLmNvbXB1dGVkVXNlclBvb2xQcm9wcy5zaWduSW5BbGlhc2VzLmVtYWlsKSB7XG4gICAgICAgIHVzZXJuYW1lQXR0cmlidXRlcy5wdXNoKCdFTUFJTCcpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzLnNpZ25JbkFsaWFzZXMucGhvbmUpIHtcbiAgICAgICAgdXNlcm5hbWVBdHRyaWJ1dGVzLnB1c2goJ1BIT05FX05VTUJFUicpO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLmNvbXB1dGVkVXNlclBvb2xQcm9wcy5zaWduSW5BbGlhc2VzLnByZWZlcnJlZFVzZXJuYW1lIHx8XG4gICAgICAgIHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzLnNpZ25JbkFsaWFzZXMudXNlcm5hbWVcbiAgICAgICkge1xuICAgICAgICB1c2VybmFtZUF0dHJpYnV0ZXMucHVzaCgnUFJFRkVSUkVEX1VTRVJOQU1FJyk7XG4gICAgICB9XG4gICAgICBpZiAodXNlcm5hbWVBdHRyaWJ1dGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgb3V0cHV0LnVzZXJuYW1lQXR0cmlidXRlcyA9IEpTT04uc3RyaW5naWZ5KHVzZXJuYW1lQXR0cmlidXRlcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzLmF1dG9WZXJpZnkpIHtcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbk1lY2hhbmlzbXMgPSBbXTtcbiAgICAgIGlmICh0aGlzLmNvbXB1dGVkVXNlclBvb2xQcm9wcy5hdXRvVmVyaWZ5LmVtYWlsKSB7XG4gICAgICAgIHZlcmlmaWNhdGlvbk1lY2hhbmlzbXMucHVzaCgnRU1BSUwnKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmNvbXB1dGVkVXNlclBvb2xQcm9wcy5hdXRvVmVyaWZ5LnBob25lKSB7XG4gICAgICAgIHZlcmlmaWNhdGlvbk1lY2hhbmlzbXMucHVzaCgnUEhPTkUnKTtcbiAgICAgIH1cbiAgICAgIGlmICh2ZXJpZmljYXRpb25NZWNoYW5pc21zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgb3V0cHV0LnZlcmlmaWNhdGlvbk1lY2hhbmlzbXMgPSBKU09OLnN0cmluZ2lmeSh2ZXJpZmljYXRpb25NZWNoYW5pc21zKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb21wdXRlZFVzZXJQb29sUHJvcHMucGFzc3dvcmRQb2xpY3kpIHtcbiAgICAgIG91dHB1dC5wYXNzd29yZFBvbGljeU1pbkxlbmd0aCA9XG4gICAgICAgIHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzLnBhc3N3b3JkUG9saWN5Lm1pbkxlbmd0aD8udG9TdHJpbmcoKTtcblxuICAgICAgY29uc3QgcmVxdWlyZW1lbnRzID0gW107XG4gICAgICBpZiAodGhpcy5jb21wdXRlZFVzZXJQb29sUHJvcHMucGFzc3dvcmRQb2xpY3kucmVxdWlyZURpZ2l0cykge1xuICAgICAgICByZXF1aXJlbWVudHMucHVzaCgnUkVRVUlSRVNfTlVNQkVSUycpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzLnBhc3N3b3JkUG9saWN5LnJlcXVpcmVMb3dlcmNhc2UpIHtcbiAgICAgICAgcmVxdWlyZW1lbnRzLnB1c2goJ1JFUVVJUkVTX0xPV0VSQ0FTRScpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzLnBhc3N3b3JkUG9saWN5LnJlcXVpcmVVcHBlcmNhc2UpIHtcbiAgICAgICAgcmVxdWlyZW1lbnRzLnB1c2goJ1JFUVVJUkVTX1VQUEVSQ0FTRScpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzLnBhc3N3b3JkUG9saWN5LnJlcXVpcmVTeW1ib2xzKSB7XG4gICAgICAgIHJlcXVpcmVtZW50cy5wdXNoKCdSRVFVSVJFU19TWU1CT0xTJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXF1aXJlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICBvdXRwdXQucGFzc3dvcmRQb2xpY3lSZXF1aXJlbWVudHMgPSBKU09OLnN0cmluZ2lmeShyZXF1aXJlbWVudHMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbXB1dGVkVXNlclBvb2xQcm9wcy5tZmEpIHtcbiAgICAgIG91dHB1dC5tZmFDb25maWd1cmF0aW9uID0gdGhpcy5jb21wdXRlZFVzZXJQb29sUHJvcHMubWZhO1xuXG4gICAgICBjb25zdCBtZmFUeXBlcyA9IFtdO1xuICAgICAgaWYgKHRoaXMuY29tcHV0ZWRVc2VyUG9vbFByb3BzLm1mYVNlY29uZEZhY3Rvcj8ub3RwKSB7XG4gICAgICAgIG1mYVR5cGVzLnB1c2goJ1RPVFAnKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmNvbXB1dGVkVXNlclBvb2xQcm9wcy5tZmFTZWNvbmRGYWN0b3I/LnNtcykge1xuICAgICAgICBtZmFUeXBlcy5wdXNoKCdTTVMnKTtcbiAgICAgIH1cbiAgICAgIGlmIChtZmFUeXBlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIG91dHB1dC5tZmFUeXBlcyA9IEpTT04uc3RyaW5naWZ5KG1mYVR5cGVzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5vYXV0aE1hcHBpbmdzW2F1dGhQcm92aWRlcnNMaXN0LmFtYXpvbl0pIHtcbiAgICAgIG91dHB1dC5hbWF6b25DbGllbnRJZCA9IHRoaXMub2F1dGhNYXBwaW5nc1thdXRoUHJvdmlkZXJzTGlzdC5hbWF6b25dO1xuICAgIH1cbiAgICBpZiAodGhpcy5vYXV0aE1hcHBpbmdzW2F1dGhQcm92aWRlcnNMaXN0LmZhY2Vib29rXSkge1xuICAgICAgb3V0cHV0LmZhY2Vib29rQ2xpZW50SWQgPSB0aGlzLm9hdXRoTWFwcGluZ3NbYXV0aFByb3ZpZGVyc0xpc3QuZmFjZWJvb2tdO1xuICAgIH1cbiAgICBpZiAodGhpcy5vYXV0aE1hcHBpbmdzW2F1dGhQcm92aWRlcnNMaXN0Lmdvb2dsZV0pIHtcbiAgICAgIG91dHB1dC5nb29nbGVDbGllbnRJZCA9IHRoaXMub2F1dGhNYXBwaW5nc1thdXRoUHJvdmlkZXJzTGlzdC5nb29nbGVdO1xuICAgIH1cbiAgICBpZiAodGhpcy5vYXV0aE1hcHBpbmdzW2F1dGhQcm92aWRlcnNMaXN0LmFwcGxlXSkge1xuICAgICAgb3V0cHV0LmFwcGxlQ2xpZW50SWQgPSB0aGlzLm9hdXRoTWFwcGluZ3NbYXV0aFByb3ZpZGVyc0xpc3QuYXBwbGVdO1xuICAgIH1cblxuICAgIG91dHB1dFN0b3JhZ2VTdHJhdGVneS5hZGRCYWNrZW5kT3V0cHV0RW50cnkoYXV0aE91dHB1dEtleSwge1xuICAgICAgdmVyc2lvbjogJzEnLFxuICAgICAgcGF5bG9hZDogb3V0cHV0LFxuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBBdHRhY2ggYSBMYW1iZGEgZnVuY3Rpb24gdHJpZ2dlciBoYW5kbGVyIHRvIHRoZSBVc2VyUG9vbCBpbiB0aGlzIGNvbnN0cnVjdFxuICAgKiBAcGFyYW0gZXZlbnQgLSBUaGUgdHJpZ2dlciBldmVudCBvcGVyYXRpb25cbiAgICogQHBhcmFtIGhhbmRsZXIgLSBUaGUgZnVuY3Rpb24gdGhhdCB3aWxsIGhhbmRsZSB0aGUgZXZlbnRcbiAgICovXG4gIGFkZFRyaWdnZXIgPSAoXG4gICAgZXZlbnQ6IFRyaWdnZXJFdmVudCxcbiAgICBoYW5kbGVyOiBJRnVuY3Rpb24gfCBBbXBsaWZ5RnVuY3Rpb25cbiAgKTogdm9pZCA9PiB7XG4gICAgaWYgKCdyZXNvdXJjZXMnIGluIGhhbmRsZXIpIHtcbiAgICAgIHRoaXMudXNlclBvb2wuYWRkVHJpZ2dlcihcbiAgICAgICAgVXNlclBvb2xPcGVyYXRpb24ub2YoZXZlbnQpLFxuICAgICAgICBoYW5kbGVyLnJlc291cmNlcy5sYW1iZGFcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGhhbmRsZXIgaXMgYW4gSUZ1bmN0aW9uXG4gICAgICB0aGlzLnVzZXJQb29sLmFkZFRyaWdnZXIoVXNlclBvb2xPcGVyYXRpb24ub2YoZXZlbnQpLCBoYW5kbGVyKTtcbiAgICB9XG4gIH07XG59XG4iXX0=