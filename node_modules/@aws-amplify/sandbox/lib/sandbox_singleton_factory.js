import { FileWatchingSandbox } from './file_watching_sandbox.js';
import { BackendDeployerFactory } from '@aws-amplify/backend-deployer';
import { AmplifySandboxExecutor } from './sandbox_executor.js';
import { CloudFormationClient } from '@aws-sdk/client-cloudformation';
import { getSecretClient } from '@aws-amplify/backend-secret';
/**
 * Factory to create a new sandbox
 */
export class SandboxSingletonFactory {
    sandboxIdResolver;
    instance;
    /**
     * sandboxIdResolver allows sandbox to lazily load the sandbox backend id on demand
     */
    constructor(sandboxIdResolver) {
        this.sandboxIdResolver = sandboxIdResolver;
    }
    /**
     * Returns a singleton instance of a Sandbox
     */
    getInstance = async () => {
        if (!this.instance) {
            this.instance = new FileWatchingSandbox(this.sandboxIdResolver, new AmplifySandboxExecutor(BackendDeployerFactory.getInstance(), getSecretClient()), new CloudFormationClient());
        }
        return this.instance;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2FuZGJveF9zaW5nbGV0b25fZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9zYW5kYm94X3NpbmdsZXRvbl9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRWpFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUU5RDs7R0FFRztBQUNILE1BQU0sT0FBTyx1QkFBdUI7SUFLTDtJQUpyQixRQUFRLENBQXNCO0lBQ3RDOztPQUVHO0lBQ0gsWUFBNkIsaUJBQTJDO1FBQTNDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBMEI7SUFBRyxDQUFDO0lBRTVFOztPQUVHO0lBQ0gsV0FBVyxHQUFHLEtBQUssSUFBc0IsRUFBRTtRQUN6QyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksbUJBQW1CLENBQ3JDLElBQUksQ0FBQyxpQkFBaUIsRUFDdEIsSUFBSSxzQkFBc0IsQ0FDeEIsc0JBQXNCLENBQUMsV0FBVyxFQUFFLEVBQ3BDLGVBQWUsRUFBRSxDQUNsQixFQUNELElBQUksb0JBQW9CLEVBQUUsQ0FDM0IsQ0FBQztTQUNIO1FBQ0QsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQztDQUNIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmlsZVdhdGNoaW5nU2FuZGJveCB9IGZyb20gJy4vZmlsZV93YXRjaGluZ19zYW5kYm94LmpzJztcbmltcG9ydCB7IEJhY2tlbmRJZFNhbmRib3hSZXNvbHZlciwgU2FuZGJveCB9IGZyb20gJy4vc2FuZGJveC5qcyc7XG5pbXBvcnQgeyBCYWNrZW5kRGVwbG95ZXJGYWN0b3J5IH0gZnJvbSAnQGF3cy1hbXBsaWZ5L2JhY2tlbmQtZGVwbG95ZXInO1xuaW1wb3J0IHsgQW1wbGlmeVNhbmRib3hFeGVjdXRvciB9IGZyb20gJy4vc2FuZGJveF9leGVjdXRvci5qcyc7XG5pbXBvcnQgeyBDbG91ZEZvcm1hdGlvbkNsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1jbG91ZGZvcm1hdGlvbic7XG5pbXBvcnQgeyBnZXRTZWNyZXRDbGllbnQgfSBmcm9tICdAYXdzLWFtcGxpZnkvYmFja2VuZC1zZWNyZXQnO1xuXG4vKipcbiAqIEZhY3RvcnkgdG8gY3JlYXRlIGEgbmV3IHNhbmRib3hcbiAqL1xuZXhwb3J0IGNsYXNzIFNhbmRib3hTaW5nbGV0b25GYWN0b3J5IHtcbiAgcHJpdmF0ZSBpbnN0YW5jZTogU2FuZGJveCB8IHVuZGVmaW5lZDtcbiAgLyoqXG4gICAqIHNhbmRib3hJZFJlc29sdmVyIGFsbG93cyBzYW5kYm94IHRvIGxhemlseSBsb2FkIHRoZSBzYW5kYm94IGJhY2tlbmQgaWQgb24gZGVtYW5kXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHNhbmRib3hJZFJlc29sdmVyOiBCYWNrZW5kSWRTYW5kYm94UmVzb2x2ZXIpIHt9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgYSBTYW5kYm94XG4gICAqL1xuICBnZXRJbnN0YW5jZSA9IGFzeW5jICgpOiBQcm9taXNlPFNhbmRib3g+ID0+IHtcbiAgICBpZiAoIXRoaXMuaW5zdGFuY2UpIHtcbiAgICAgIHRoaXMuaW5zdGFuY2UgPSBuZXcgRmlsZVdhdGNoaW5nU2FuZGJveChcbiAgICAgICAgdGhpcy5zYW5kYm94SWRSZXNvbHZlcixcbiAgICAgICAgbmV3IEFtcGxpZnlTYW5kYm94RXhlY3V0b3IoXG4gICAgICAgICAgQmFja2VuZERlcGxveWVyRmFjdG9yeS5nZXRJbnN0YW5jZSgpLFxuICAgICAgICAgIGdldFNlY3JldENsaWVudCgpXG4gICAgICAgICksXG4gICAgICAgIG5ldyBDbG91ZEZvcm1hdGlvbkNsaWVudCgpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgfTtcbn1cbiJdfQ==