"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsageDataEmitterFactory = void 0;
const local_configuration_controller_factory_js_1 = require("../config/local_configuration_controller_factory.js");
const noop_usage_data_emitter_js_1 = require("./noop_usage_data_emitter.js");
const usage_data_emitter_js_1 = require("./usage_data_emitter.js");
const constants_js_1 = require("./constants.js");
/**
 * Creates UsageDataEmitter for a given library version
 */
class UsageDataEmitterFactory {
    /**
     * Creates UsageDataEmitter for a given library version, usage data tracking preferences
     */
    getInstance = async (libraryVersion) => {
        const configController = await local_configuration_controller_factory_js_1.configControllerFactory.getInstance('usage_data_preferences.json');
        const usageDataTrackingDisabledLocalFile = (await configController.get(constants_js_1.USAGE_DATA_TRACKING_ENABLED)) ===
            false;
        if (process.env.AMPLIFY_DISABLE_TELEMETRY ||
            usageDataTrackingDisabledLocalFile) {
            return new noop_usage_data_emitter_js_1.NoOpUsageDataEmitter();
        }
        return new usage_data_emitter_js_1.DefaultUsageDataEmitter(libraryVersion);
    };
}
exports.UsageDataEmitterFactory = UsageDataEmitterFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNhZ2VfZGF0YV9lbWl0dGVyX2ZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXNhZ2UtZGF0YS91c2FnZV9kYXRhX2VtaXR0ZXJfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtSEFBOEY7QUFDOUYsNkVBQW9FO0FBQ3BFLG1FQUFrRTtBQUNsRSxpREFBNkQ7QUFhN0Q7O0dBRUc7QUFDSCxNQUFhLHVCQUF1QjtJQUNsQzs7T0FFRztJQUNILFdBQVcsR0FBRyxLQUFLLEVBQUUsY0FBc0IsRUFBNkIsRUFBRTtRQUN4RSxNQUFNLGdCQUFnQixHQUFHLE1BQU0sbUVBQXVCLENBQUMsV0FBVyxDQUNoRSw2QkFBNkIsQ0FDOUIsQ0FBQztRQUVGLE1BQU0sa0NBQWtDLEdBQ3RDLENBQUMsTUFBTSxnQkFBZ0IsQ0FBQyxHQUFHLENBQVUsMENBQTJCLENBQUMsQ0FBQztZQUNsRSxLQUFLLENBQUM7UUFFUixJQUNFLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCO1lBQ3JDLGtDQUFrQyxFQUNsQztZQUNBLE9BQU8sSUFBSSxpREFBb0IsRUFBRSxDQUFDO1NBQ25DO1FBQ0QsT0FBTyxJQUFJLCtDQUF1QixDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3JELENBQUMsQ0FBQztDQUNIO0FBckJELDBEQXFCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbmZpZ0NvbnRyb2xsZXJGYWN0b3J5IH0gZnJvbSAnLi4vY29uZmlnL2xvY2FsX2NvbmZpZ3VyYXRpb25fY29udHJvbGxlcl9mYWN0b3J5LmpzJztcbmltcG9ydCB7IE5vT3BVc2FnZURhdGFFbWl0dGVyIH0gZnJvbSAnLi9ub29wX3VzYWdlX2RhdGFfZW1pdHRlci5qcyc7XG5pbXBvcnQgeyBEZWZhdWx0VXNhZ2VEYXRhRW1pdHRlciB9IGZyb20gJy4vdXNhZ2VfZGF0YV9lbWl0dGVyLmpzJztcbmltcG9ydCB7IFVTQUdFX0RBVEFfVFJBQ0tJTkdfRU5BQkxFRCB9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcblxuZXhwb3J0IHR5cGUgVXNhZ2VEYXRhRW1pdHRlciA9IHtcbiAgZW1pdFN1Y2Nlc3M6IChcbiAgICBtZXRyaWNzPzogUmVjb3JkPHN0cmluZywgbnVtYmVyPixcbiAgICBkaW1lbnNpb25zPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPlxuICApID0+IFByb21pc2U8dm9pZD47XG4gIGVtaXRGYWlsdXJlOiAoXG4gICAgZXJyb3I6IEVycm9yLFxuICAgIGRpbWVuc2lvbnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG4gICkgPT4gUHJvbWlzZTx2b2lkPjtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBVc2FnZURhdGFFbWl0dGVyIGZvciBhIGdpdmVuIGxpYnJhcnkgdmVyc2lvblxuICovXG5leHBvcnQgY2xhc3MgVXNhZ2VEYXRhRW1pdHRlckZhY3Rvcnkge1xuICAvKipcbiAgICogQ3JlYXRlcyBVc2FnZURhdGFFbWl0dGVyIGZvciBhIGdpdmVuIGxpYnJhcnkgdmVyc2lvbiwgdXNhZ2UgZGF0YSB0cmFja2luZyBwcmVmZXJlbmNlc1xuICAgKi9cbiAgZ2V0SW5zdGFuY2UgPSBhc3luYyAobGlicmFyeVZlcnNpb246IHN0cmluZyk6IFByb21pc2U8VXNhZ2VEYXRhRW1pdHRlcj4gPT4ge1xuICAgIGNvbnN0IGNvbmZpZ0NvbnRyb2xsZXIgPSBhd2FpdCBjb25maWdDb250cm9sbGVyRmFjdG9yeS5nZXRJbnN0YW5jZShcbiAgICAgICd1c2FnZV9kYXRhX3ByZWZlcmVuY2VzLmpzb24nXG4gICAgKTtcblxuICAgIGNvbnN0IHVzYWdlRGF0YVRyYWNraW5nRGlzYWJsZWRMb2NhbEZpbGUgPVxuICAgICAgKGF3YWl0IGNvbmZpZ0NvbnRyb2xsZXIuZ2V0PGJvb2xlYW4+KFVTQUdFX0RBVEFfVFJBQ0tJTkdfRU5BQkxFRCkpID09PVxuICAgICAgZmFsc2U7XG5cbiAgICBpZiAoXG4gICAgICBwcm9jZXNzLmVudi5BTVBMSUZZX0RJU0FCTEVfVEVMRU1FVFJZIHx8XG4gICAgICB1c2FnZURhdGFUcmFja2luZ0Rpc2FibGVkTG9jYWxGaWxlXG4gICAgKSB7XG4gICAgICByZXR1cm4gbmV3IE5vT3BVc2FnZURhdGFFbWl0dGVyKCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgRGVmYXVsdFVzYWdlRGF0YUVtaXR0ZXIobGlicmFyeVZlcnNpb24pO1xuICB9O1xufVxuIl19